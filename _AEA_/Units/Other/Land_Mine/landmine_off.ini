[core]
copyFrom: ROOT:effects.template
name: landmineOff
class: CustomUnitMetadata
price: 800
maxHp: 10
mass: 3000
displayText: Landmine (auto off)
displayDescription: - Small Activation Range (Small Ring) \n- Can be Disarmed by Enemy Engineers (Middle Ring) \n- Remote Detonation From Engineers (Large Ring) \n- Does 500 damage (AOE) \n- Cannot be attacked
canNotBeDirectlyAttacked:true
displayText_ru: Мина (Авто-детонация отключена)
displayDescription_ru: - Маленький радиус для активации \n - Может быть обезврежена вражескими инженерами \n - Наносит урон по большой площади \n - Не может быть атакована.
displayText_zh: 地雷（自动关闭）
displayDescription_zh: -小范围内激活\n-可以被敌方工程师单位解除\n-可以被己方工程师远程引爆\n-造成500点伤害（AOE）\n-无法被瞄准攻击

techLevel: 1
buildSpeed: 0.0040
#availableInDemo: true

transportSlotsNeeded: 9999

showInEditor: false
tags: land_mines, lds, mineOff, IMNOTDEAD,
fogOfWarSightRange: 5
radius: 9
#displayRadius: 9
isBio: false
softCollisionOnAll: 0

disableAllUnitCollisions: true

isBuilding: false

#footprint used for collisions with units (left, up, right, down)
#footprint: -0,-0,0,0
#used for placement, and placement of other buildings
#constructionFootprint:-0,-0,0,0

#buildingToFootprintOffsetX:20
#buildingToFootprintOffsetY:10


#---------------------------------Added 
[placementRule_mines_own]
@define rng: 70
#anyRuleInGroup: place
searchTags: land_mines
searchDistance: ${rng}
searchTeam:any

excludeIncompleteBuildings: true
excludeNonBuildings: false
minCount: 0
maxCount: 0
blocksPlacement: true
cannotPlaceMessage: Cannot place Landmine within ${rng} range
cannotPlaceMessage_zh: 不能在${rng}范围内放置地雷
checkEachTile: true
[hiddenAction_clearWaypoint]
autoTriggerOnEvent: newWaypointGivenByPlayer
clearActiveWaypoint: true
#---------------------------------END 
[hiddenAction_BuildOFf]
autoTriggerOnEvent: created
requireConditional: if numberOfUnitsInTeam(greaterThan=0, withTag='lds', withinRange= 70, incompleteBuildings=true)
deleteSelf: true
addResources: ${core.price}
showMessageToPlayer: Cannot place here!
showMessageToPlayer_ru: Здесь нельзя поместить мину!
showMessageToPlayer_zh: 不能在此处放置!

[action_autoOn]
text: Enable AutoDetonate
description: - Turns on auto detonation when units get in range\n- Takes 10 seconds
text_ru: Включить Авто-детонацию
description_ru: - Возвращает автоматическое срабатывание
text_zh: 启用自动引爆
description_zh: -当单位进入范围时自动引爆\n-需要10秒时间
convertTo: landmineBuilt
displayType: action
isGuiBlinking: true
buildSpeed: 2s

[hiddenAction_RemoteDetonate]
autoTriggerOnEvent: newMessage(withTag="detonate_ownLM")
fireTurretXAtGround: 1



[action_detonate]
isActive: true
isVisible: true
buildSpeed: 0s
text: Detonate
text_zh: 引爆
text_ru: Подорвать
iconImage: warning.png
fireTurretXAtGround: 1
fireTurretXAtGround_withOffset: 0,0
########################################### diffused
[hiddenAction_diffusedLandmind]
autoTriggerOnEvent: newMessage(withTag="diffuseLandmine")
deleteSelf: true
addResources: hp=-${core.maxHp}
spawnEffects:CUSTOM:diffLM
[effect_diffLM]
xOffsetRelative:0
yOffsetRelative:0
priority:critical
image:ROOT:data\images\YouMad.png
life: 500
fadeOut: true
dirOffsetRandom: 180
attachedToUnit: false
color: #ffffff
fadeInTime: 1
scaleFrom: 0.35
scaleTo: 0.35
alpha: 2
createWhenOverLiquid: false
drawUnderUnits: true
###########################################

[hiddenAction_ShowLandMines]
text: hiddenAction_ShowLandMines
description: - Shows the location of landmines when engineer is within range
spawnEffects:CUSTOM:mineFlare
# WOULD ADJUST WITHRANGE=800 TO WHATEVER
autoTrigger: if numberOfUnitsInEnemyTeam(greaterThan=0, withTag='Engineer', withinRange=800)


# MUST MATCH ACTION REMOTE DET RANGE
[turret_RemoteRangeUI]
x:0
y:0
turnSpeed: 0
limitingRange: 800
showRangeUIGuide: true

# MUST MATCH ACTION DISARM RANGE
[turret_DisarmRangeUI]
x:0
y:0
turnSpeed: 0
limitingRange: 360
showRangeUIGuide: true


[graphics]
total_frames: 4
icon_zoomed_out: mine_off.png
image:      simple_mine.png
image_wreak:  NONE
image_turret: NONE

image_shadow: AUTO
shadowOffsetX:1
shadowOffsetY:1

animation_idle_start: 3
animation_idle_end: 3
animation_idle_speed: 4

isVisibleToEnemies: false

[attack]
dieOnAttack: true
isMelee: false
canAttack: false
canAttackFlyingUnits: false
canAttackLandUnits:   false
canAttackUnderwaterUnits: false
canAttackNotTouchingWaterUnits: false

turretSize: 20
turretTurnSpeed: 4

maxAttackRange: 70


[turret_1]
invisible: true
x: 0
y: 0
idleDir:0
canAttackFlyingUnits: false
canAttackLandUnits:   false
canAttackUnderwaterUnits: false
canAttackNotTouchingWaterUnits: false
delay: 1
limitingRange: 70
showRangeUIGuide: true
projectile: 1
size: 1.1
turnSpeed: 15



[projectile_1]
directDamage: 0
life: 0
instant: true
frame: 15
areaRadius: 200
areaDamage: 500

largeHitEffect: true
#targetGround: true

[movement]
movementType: LAND
moveSpeed: 0
moveAccelerationSpeed: 0
moveDecelerationSpeed: 0

targetHeight: -3
targetHeightDrift: 0

maxTurnSpeed: 0
turnAcceleration: 0

moveSlidingMode :false
moveIgnoringBody:false





