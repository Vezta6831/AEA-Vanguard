[core]
name: faction_picker
displayText: Faction Picker
displayDescription: Pick a faction

price: 500
maxHp: 2000
mass: 9000
radius: 16
#isPickableStartingUnit: true
isBuilding: true
overrideAndReplace: commandCenter
tags: picker, AvB_player
#canBuild_1_name: builder
#canBuild_1_pos: 1
[hiddenAction_createCreditsMessage]
autoTriggerOnEvent: created
showQuickWarLogToPlayer: Standard Mode 
[canBuild_1]
name: builder
pos: 1
isVisible: false

#------------------------------------------------------------------------
#if map has more than one command center, this code will trigger preventing player from being gay

#-----------Faction ------- reciever
[hiddenAction_selectAEA_reciever]
autoTriggerOnEvent: newMessage(withTag="selectAEA")
alsoTriggerAction: commandCenter

[hiddenAction_selectBGC_reciever]
autoTriggerOnEvent: newMessage(withTag="selectBGC")
alsoTriggerAction: blackgaurd

[hiddenAction_selectEKE_reciever]
autoTriggerOnEvent: newMessage(withTag="selectEKE")
alsoTriggerAction: EKE

[hiddenAction_selectTZP_reciever]
autoTriggerOnEvent: newMessage(withTag="selectTZP")
alsoTriggerAction: TZP

[hiddenAction_selectTRTL_reciever]
autoTriggerOnEvent: newMessage(withTag="selectTRTL")
alsoTriggerAction: TRTL


#-----------READY
[hiddenAction_ready_reciever]
autoTriggerOnEvent: newMessage(withTag="readyASS")
alsoTriggerAction: readyUp

#-----------Faction ------- sender
[hiddenAction_selectAEA_sender]
requireConditional: if self.numberOfUnitsInTeam(withTag='picker')>1
	sendMessageTo: unitref nearestUnit(withTag="picker")
	sendMessageWithTags: selectAEA

[hiddenAction_selectBGC_sender]
@copyFromSection: hiddenAction_selectAEA_sender
	sendMessageTo: unitref nearestUnit(withTag="picker")
	sendMessageWithTags: selectBGC

[hiddenAction_selectEKE_sender]
@copyFromSection: hiddenAction_selectAEA_sender
	sendMessageTo: unitref nearestUnit(withTag="picker")
	sendMessageWithTags: selectEKE

[hiddenAction_selectTZP_sender]
@copyFromSection: hiddenAction_selectAEA_sender
	sendMessageTo: unitref nearestUnit(withTag="picker")
	sendMessageWithTags: selectTZP


[hiddenAction_selectTRTL_sender]
@copyFromSection: hiddenAction_selectAEA_sender
	sendMessageTo: unitref nearestUnit(withTag="picker")
	sendMessageWithTags: selectTRTL

#-----------READY
[hiddenAction_ready_sender]
@copyFromSection: hiddenAction_selectAEA_sender
	sendMessageTo: unitref nearestUnit(withTag="picker")
	sendMessageWithTags: readyASS	
	
#------------------------------------------------------------------------
	
[action_commandCenter]
@define pr: 1
isLocked: if self.hasFlag(id=10)

text: AEA
displayType: Upgrade
description: The Megacorporation AEA,\n- Well known for its leading standards in military production\n- Most versitile aresenal\n- Best at quickly expanding map control\n- Special units Infantry, PCW, Xan, Leviathan, hacker, ChronoShift. \n- "Its just business, whatever rolls in the profits"
buildSpeed: 1
ai_isHighPriority:true
iconImage: AEA.png
iconExtraImage: ROOT:data\icons\select.png
iconExtraIsVisible: if self.hasFlag(id=${pr})
addResources: unsetFlag=1-5, setFlag=${pr}, setFlag=31
isGuiBlinking: if self.hasFlag(id=${pr})
allowMultipleInQueue: false
alwaysSinglePress: true
#showQuickWarLogToPlayer:|-> AEA <-|
alsoTriggerAction: AiInstaReady, selectAEA_sender

[action_blackgaurd]
@copyFromSection: action_commandCenter
@define pr: 2
#convertTo: gateway
text: BGC
description: Galactic mining company Black Guard, \n- extremely powerful Mechs with many modules to customize your units as needed. \n- Limited air and naval capabilities. \n- very powerful End game Units and Structures, but pitiful early game structures. \n- Special Units, ApolloII, Widow, Shikishia, Plasma Beetle, Leyte, Typhoon. \n- "All for the Chairman. may the Harvest be Plentiful" 
#setFlag 31 for module
addResources: unsetFlag=1-5, setFlag=${pr}, setFlag=31
iconImage: BGC.png
#showQuickWarLogToPlayer:|-> BGC <-|
alsoTriggerAction: AiInstaReady, selectBGC_sender

[action_EKE]
@copyFromSection: action_commandCenter
@define pr: 3
#convertTo: gateway
text: EKE
description: EKEngineering, part of the Planetary Defense Agency,\n- Offers best structural defences\n- Uses "Power" to call in orbital strikes\n- Special units, Excelsior, Elizabeth, T3 Air Units, Morning Star, FAT BOYII, Air Strikes, Nicol Dyson Beam. \n- "Give it your all, this is for our homeworld!"
#setFlag 31 for module
addResources: unsetFlag=1-5, setFlag=${pr}, setFlag=31
iconImage: EKE.png
#showQuickWarLogToPlayer:|-> EKE <-|
alsoTriggerAction: AiInstaReady, selectEKE_sender

[action_TZP]
@copyFromSection: action_commandCenter
@define pr: 4
#convertTo: gateway
text: TZP
description: Terran, Protoss and Zerg. They join together in an unlikely alliance, to ward off the new foes seeking dominion over their home Galaxy.
#setFlag 31 for module
addResources: unsetFlag=1-5, setFlag=${pr}, setFlag=31
iconImage: TZP.png
#showQuickWarLogToPlayer:|-> TZP <-|
alsoTriggerAction: AiInstaReady, selectTZP_sender

[action_TRTL]
@copyFromSection: action_commandCenter
@define pr: 5
#convertTo: gateway
text: TRTL
description: TURTLE FACTION
#setFlag 31 for module
addResources: unsetFlag=1-5, setFlag=${pr}, setFlag=31
iconImage: TRTL.png
#showQuickWarLogToPlayer:|-> TRTL <-|
alsoTriggerAction: AiInstaReady, selectTRTL_sender


#-----------------------------------Added code
[hiddenAction_Delay_BattleStart_A]
autoTrigger: if numberOfUnitsInAggressiveTeam(greaterThan=0, withTag='BattleStart_DS') and self.hasFlag(id=1) and self.tags(includes='Armed')

[hiddenAction_Delay_BattleStart_B]
autoTrigger: if numberOfUnitsInAggressiveTeam(greaterThan=0, withTag='BattleStart_DS') and self.hasFlag(id=2) and self.tags(includes='Armed')

[hiddenAction_Delay_BattleStart_C]
autoTrigger: if numberOfUnitsInAggressiveTeam(greaterThan=0, withTag='BattleStart_DS') and self.hasFlag(id=3) and self.tags(includes='Armed')

[hiddenAction_Delay_BattleStart_D]
autoTrigger: if numberOfUnitsInAggressiveTeam(greaterThan=0, withTag='BattleStart_DS') and self.hasFlag(id=4) and self.tags(includes='Armed')

[hiddenAction_Delay_BattleStart_E]
autoTrigger: if numberOfUnitsInAggressiveTeam(greaterThan=0, withTag='BattleStart_DS') and self.hasFlag(id=5) and self.tags(includes='Armed')

[hiddenAction_BattleStart_A]
@copyFromSection: template_shaderEffect_a
autoTrigger: if numberOfUnitsInAggressiveTeam(greaterThan=0, withTag='BattleStart_DS') and self.hasFlag(id=1) and self.tags(includes='Armed')
convertTo: commandCenterAEA
showQuickWarLogToPlayer: Faction: Megacorporation AEA\n |----------- Command Center\n |----------- Credits generated! \n |----------- Produce starting unit: Builder
produceUnits: builder
addResources:maxfabs=40, setFlag=30-31
addGlobalTeamTags: IAMAEA 

[hiddenAction_BattleStart_B]
@copyFromSection: template_shaderEffect_a
autoTrigger: if numberOfUnitsInAggressiveTeam(greaterThan=0, withTag='BattleStart_DS') and self.hasFlag(id=2) and self.tags(includes='Armed')
convertTo: gateway
showQuickWarLogToPlayer: Faction: Galactic mining BGC\n |----------- Gate Way \n |----------- Global Core generated! \n |----------- Produce starting unit: Dark Drone
produceUnits: darkdrone_temp
addResources:maxfabs=40, setFlag=30-31
addGlobalTeamTags: IAMBGC

[hiddenAction_BattleStart_C]
@copyFromSection: template_shaderEffect_a
autoTrigger: if numberOfUnitsInAggressiveTeam(greaterThan=0, withTag='BattleStart_DS') and self.hasFlag(id=3) and self.tags(includes='Armed')
convertTo: EkCC
showQuickWarLogToPlayer: Faction: Planetary Defense Agency EKE \n |----------- Ek Command Center \n |----------- 250 Power resource generated! \n |----------- Produce starting unit: TCV
addResources:maxpower=250, maxfabs=40, setFlag=30-31
produceUnits: MCV
addGlobalTeamTags: EKE_noHack, IAMEKE


[hiddenAction_BattleStart_D]
@copyFromSection: template_shaderEffect_a
autoTrigger: if numberOfUnitsInAggressiveTeam(greaterThan=0, withTag='BattleStart_DS') and self.hasFlag(id=4) and self.tags(includes='Armed')
convertTo: commandCenterTZP
showQuickWarLogToPlayer: Faction: Planetary Defense Agency EKE \n |----------- Ek Command Center \n |----------- 250 Power resource generated! \n |----------- Produce starting unit: TCV
addResources:maxpower=250, maxfabs=40, setFlag=30-31
addGlobalTeamTags: IAMTZP


[hiddenAction_BattleStart_E]
@copyFromSection: template_shaderEffect_a
autoTrigger: if numberOfUnitsInAggressiveTeam(greaterThan=0, withTag='BattleStart_DS') and self.hasFlag(id=5) and self.tags(includes='Armed')
convertTo: commandCenterTRTL
showQuickWarLogToPlayer: Faction: Planetary Defense Agency EKE \n |----------- Ek Command Center \n |----------- 250 Power resource generated! \n |----------- Produce starting unit: TCV
addResources:maxpower=250, maxfabs=40, setFlag=30-31
produceUnits: buildertrtl
addGlobalTeamTags: IAMTRTL

[template_shaderEffect_a]
spawnEffects: CUSTOM:blinkChargeOut_displacement

#-------------Ai 
[hiddenAction_AiInstaReady]
requireConditional: if self.isControlledByAI()
temporarilyAddTags: Armed
showMessageToAllPlayers: %{self.playerName} is ready!
[action_readyUp]
#ai_isDisabled: if not self.hasFlag(id=1) or not self.hasFlag(id=2)
ai_isHighPriority: true
isActive: if self.hasFlag(id=1) or self.hasFlag(id=2) or self.hasFlag(id=3) or self.hasFlag(id=4) or self.hasFlag(id=5)
isLockedAlt: if not self.customTimer(laterThanSeconds=10) 
isLocked: if self.tags(includes='Armed')
text: Ready
temporarilyAddTags: Armed
showMessageToAllPlayers: %{self.playerName} is ready!
buildSpeed: 0.3s
alsoTriggerAction: ready_sender
#--------------------------RND
[action_RND]
isVisible: false
#isVisible: if not self.hasFlag(id=10) and self.queueSize() < 1
text: Random Faction
text_ru: Случайная Фракция
text_zh: 随机阵营
buildSpeed: 0s
description: When set, player cannot switch faction
alsoTriggerAction: start_rnd
showQuickWarLogToPlayer: Start selecting random faction
showQuickWarLogToPlayer_ru: Начинается выбор случайной фракции...
iconImage: ROOT:data\icons\rnd.png
#[action_1212]
#text: 2121
#buildSpeed: 0
#addResources: unsetFlag=10
#-----
[hiddenAction_start_rnd]
requireConditional: if not self.hasFlag(id=10)
buildSpeed: 0.05s
alsoQueueAction: start_rnd2
alsoTriggerAction: rnd_AEA
showQuickWarLogToPlayer: |
showQuickWarLogToPlayer_ru: |
[hiddenAction_start_rnd2]
@copyFromSection:hiddenAction_start_rnd
alsoQueueAction: start_rnd3
alsoTriggerAction: rnd_BGC
[hiddenAction_start_rnd3]
@copyFromSection:hiddenAction_start_rnd
alsoQueueAction: start_rnd
alsoTriggerAction: rnd_EKE

#-----
[hiddenAction_rnd_AEA]
requireConditional: if rnd(0,0.3) >= 0.2
alsoTriggerAction: rnd_AEA2
[hiddenAction_rnd_BGC]
@copyFromSection:hiddenAction_rnd_AEA
alsoTriggerAction: rnd_BGC2
[hiddenAction_rnd_EKE]
@copyFromSection:hiddenAction_rnd_AEA
alsoTriggerAction: rnd_EKE2
#######################################
[hiddenAction_rnd_AEA2]
@define pr: 1
requireConditional: if rnd(0,0.3) >= 0.2
showQuickWarLogToPlayer: Random faction selected: |-> AEA <-|
addResources: setFlag=10, unsetFlag=2-3, setFlag=${pr}, setFlag=31
alsoQueueAction: readyUp

[hiddenAction_rnd_BGC2]
@define pr: 2
@copyFromSection:hiddenAction_rnd_AEA2
showQuickWarLogToPlayer: Random faction selected: |-> BGC <-|

[hiddenAction_rnd_EKE2]
@define pr: 3
@copyFromSection:hiddenAction_rnd_AEA2
showQuickWarLogToPlayer: Random faction selected: |-> EKE <-|

#-----------------------------------
#effects
[effect_blinkChargeOut_displacement]
drawType: displacement
image: SHARED:shockwave_normal_128.png
life: 80
fadeOut: true
fadeInTime: 5
attachedToUnit: false
color: #FFFFFF
scaleFrom: 1.0
scaleTo: 4.0
alpha: 0.4
drawUnderUnits:false
alwayStartDirAtZero: true
#----------------------------------------
[arm_1]
#AEA
@define pr: 1
x: 0
y: 0
image_end: _temp_${pr}.png
hidden: if not self.hasFlag(id=${pr})
[arm_2]
@copyFromSection: arm_1
@define pr: 2
[arm_3]
@copyFromSection: arm_1
@define pr: 3

#-----------------Ready
[arm_4]
@copyFromSection: arm_1
@define pr: 1
image_end: _temp_${pr}_r.png
hidden: if not self.hasFlag(id=${pr}) and self.tags(includes='Armed') or not self.tags(includes='Armed')
[arm_5]
@copyFromSection: arm_4
@define pr: 2
[arm_6]
@copyFromSection: arm_4
@define pr: 3


[arm_9]
x: 0
y: 0
image_end: picker.png
hidden: if self.hasFlag(id=1) or self.hasFlag(id=2) or self.hasFlag(id=3) or self.hasFlag(id=4)

[graphics]
image:        ROOT:data\null.png
image_back:   bck.png
[attack]
canAttack: false
canAttackFlyingUnits: false
canAttackLandUnits:   true
canAttackUnderwaterUnits: false
[movement]
movementType: NONE
[ai]
useAsBuilder:true