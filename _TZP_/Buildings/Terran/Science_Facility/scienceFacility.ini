[core]
copyFrom:ROOT:/DATA/total/baseAttack.template, ROOT:/DATA/total/debuffs.template, ROOT:/DATA/Terran/buildings.template, ROOT:/DATA/total/customUI.template
name: ScienceFacility
tags: ScienceFacility,building,mech
class: CustomUnitMetadata
price: 0
generation_resources: Gas=0.25
maxHp: 3200
mass: 9000
armour:1
hideScorchMark: false
fogOfWarSightRange:17
displayText_ru:Научный центр
displayText:Science facility
displayDescription: -Allows for construction of advanced units\n-Upgrades for specialist units\n-Can construct Ghost or BattleCruiser addon
footprint: -2,-2,3,1
constructionFootprint:-2,-2,3,1
buildingToFootprintOffsetX:20
buildingToFootprintOffsetY:-10
exit_x:0
exit_y:40
techLevel: 1
buildSpeed: 1
selfBuildRate: 1
nanoRange:9999
radius: 70
isBuilder:true
isBuilding: true
isBio: true
numBitsOnDeath: 12
isUnrepairableUnit:false
effectOnDeath:CUSTOM:corpse
soundOnNewSelection:ScienceFacility.ogg:0.3

[canBuild_1]
isVisible: if ((((not self.getOffsetAbsolute(x=90,y=20).self.hasUnitInTeam(withTag="COps",withinRange=10) and not self.isControlledByAI()) or (not self.hasUnitInTeam(withTag="COps", withinRange=100) and self.isControlledByAI())) and ((not self.getOffsetAbsolute(x=90,y=20).self.hasUnitInTeam(withTag="PL",withinRange=10) and not self.isControlledByAI()) or (not self.hasUnitInTeam(withTag="PL", withinRange=100) and self.isControlledByAI()))) and (not self.globalTeamTags(includes="CovertOpsLocked"))) and not self.globalTeamTags(includes='Campaign')
name:PhysicalLabBuild

[canBuild_2]
isVisible: if ((((not self.getOffsetAbsolute(x=90,y=20).self.hasUnitInTeam(withTag="COps",withinRange=10) and not self.isControlledByAI()) or (not self.hasUnitInTeam(withTag="COps", withinRange=100) and self.isControlledByAI())) and ((not self.getOffsetAbsolute(x=90,y=20).self.hasUnitInTeam(withTag="PL",withinRange=10) and not self.isControlledByAI()) or (not self.hasUnitInTeam(withTag="PL", withinRange=100) and self.isControlledByAI()))) and (not self.globalTeamTags(includes="PhysicalLabLocked"))) and not self.globalTeamTags(includes='Campaign')
name:CovertOpsBuild

[action_Convert1]
ai_isHighPriority: if self.resource.uranium < 25000
text: Convert Minerals
description: - Convert Minerals to Vespene Gas\n- 1200 Minerals to 600 Gas
isGuiBlinking: true
buildSpeed: 15s
price: Minerals=4800
addResources:Gas:800

[action_Convert2]
ai_isHighPriority: if self.resource.uranium < 25000
text: Convert Gas
description: - Convert Vespene Gas to Minerals\n- 600 Gas to 1200 Minerals
isGuiBlinking: true
buildSpeed: 12s
price: Gas=800
addResources:Minerals:4800


[effect_corpse]
alwayStartDirAtZero:true
attachedToUnit: false
life: 120
alpha: 12
image:ROOT:/DATA/Terran/death.png
alsoPlaySound:ROOT:/DATA/total/buildingExplode.wav
priority: critical
drawUnderUnits:false
animateFrameStart:0
animateFrameEnd:11
animateFrameSpeed:0.2
frame_width:  252
frame_height: 200

[effect_up]
alwayStartDirAtZero:true
attachedToUnit: false
life: 100
alpha: 10
image:ROOT:/DATA/Terran/dust_6.png
priority: critical
drawUnderUnits:false
animateFrameStart:0
animateFrameEnd:9
animateFrameSpeed:0.2
frame_width:  48
frame_height: 48
xOffsetAbsolute: -40
yOffsetAbsolute: 30

[effect_up_2]
image:ROOT:/DATA/Terran/dust_8.png
xOffsetAbsolute: 0
yOffsetAbsolute: 45
@copyFromSection: effect_up

[effect_up_3]
image:ROOT:/DATA/Terran/dust_7.png
xOffsetAbsolute: 40
yOffsetAbsolute: 30
@copyFromSection: effect_up
alsoPlaySound:ROOT:/DATA/Terran/liftoff.wav

[hiddenAction_ai]
autoTrigger: if self.isControlledByAI() and not self.tags(includes='AIScienceFacility')
temporarilyAddTags: AIScienceFacility

[action_clear]
isVisible:true
isActive:true
buildSpeed:1s
price:0
text_ru:Уничтожить
text:Delete
iconImage:ROOT:/DATA/total/delete.png
addResources:hp=-1500
ai_isDisabled:true

[action_irradiate]
isVisible: if not self.globalTeamTags(includes='Radiation')
isActive: if not self.globalTeamTags(includes='Radiation')
buildSpeed:50s
displayType: upgrade
text_ru:Улучшение
text:Upgrade
description_ru:Облучение\n Накладывается на биологических юнитов и наносит им урон
description:Irradiate\n Damages a biological unit and adjacent biological units
price:Gas=600
playSoundToPlayer:ROOT:/DATA/Terran/research.ogg:0.4
onlyOneUnitAtATime: true
allowMultipleInQueue:false
addGlobalTeamTags:Radiation
iconImage:ROOT:/DATA/Terran/irradiate.png
ai_isHighPriority:true
whenBuilding_playAnimation:build

[action_EMP]
isVisible: if not self.globalTeamTags(includes='EMPupgrade')
isActive: if not self.globalTeamTags(includes='EMPupgrade')
buildSpeed:68s
displayType: upgrade
text_ru:Улучшение
text:Upgrade
description_ru:Электромагнитный импульс\n Истощает энергию и щиты у всех юнитов и зданий в радиусе действия
description:EMP Shockwave\n Depletes the energy and shields of all units and buildings within its area of effect
price:Gas=500
playSoundToPlayer:ROOT:/DATA/Terran/research.ogg:0.4
onlyOneUnitAtATime: true
allowMultipleInQueue:false
addGlobalTeamTags:EMPupgrade
iconImage:ROOT:/DATA/Terran/emp.png
ai_isHighPriority:true
whenBuilding_playAnimation:build

[action_titanReactor]
isVisible: if not self.globalTeamTags(includes='TitanReactor')
isActive: if not self.globalTeamTags(includes='TitanReactor')
buildSpeed:55s
displayType: upgrade
text_ru:Улучшение
text:Upgrade
description_ru:Реактор Титан\n Увеличивает максимальный запас энергии Научного судна с 200 до 250 (+50) и начальную энергию на 12
description:Titan reactor\n Increasing the Sckence Vessel's maximum energy to from 200 to 250 (+50) and starting energy by 12
price:Gas=450
playSoundToPlayer:ROOT:/DATA/Terran/research.ogg:0.4
onlyOneUnitAtATime: true
iconImage:titanReactor.png
allowMultipleInQueue:false
addGlobalTeamTags:TitanReactor
ai_isHighPriority:true

[action_air]
isVisible:true
isActive:true
text_ru:Поднять здание
text:Rise up
ai_isDisabled:true
iconImage:ROOT:/DATA/Terran/liftoff.png
convertTo:ScienceFacilityAir
convertTo_keepCurrentTags: true
buildSpeed: 0.8s
highPriorityQueue: true
whenBuilding_temporarilyConvertTo: ScienceFacilityAir
whenBuilding_playAnimation:air
whenBuilding_cannotMove:true
whenBuilding_rotateTo:270
canPlayerCancel:false

[decal_fire]
@copyFromSection: template_fire
isVisible: if self.hp<self.maxHp*0.85
image:ROOT:/DATA/Terran/fire2.png
frame: select(self.hp<self.maxHp*0.7,12,0)+(self.timeAlive*12%12)
xOffsetAbsolute:-18
yOffsetAbsolute:-6

[decal_fire_2]
@copyFromSection: template_fire
isVisible: if self.hp<self.maxHp*0.55
image:ROOT:/DATA/Terran/fire3.png
frame: select(self.hp<self.maxHp*0.4,12,0)+(self.timeAlive*12%12)
xOffsetAbsolute:20
yOffsetAbsolute:-34

[hiddenAction_addPhysicsLab]
autoTrigger: if numberOfUnitsInTeam(withTag='PhysicalLab',withinRange=100,greaterThan=0) and not self.tags(includes='ScienceFacilityPL')
temporarilyAddTags: ScienceFacilityPL

[hiddenAction_addCovertOps]
autoTrigger: if numberOfUnitsInTeam(withTag='CovertOps',withinRange=100,greaterThan=0) and not self.tags(includes='ScienceFacilityCO')
temporarilyAddTags: ScienceFacilityCO

[hiddenAction_deletePhysicsLab]
autoTrigger: if numberOfUnitsInTeam(withTag='PhysicalLab',withinRange=100,lessThan=1) and self.tags(includes='ScienceFacilityPL')
temporarilyRemoveTags: ScienceFacilityPL

[hiddenAction_deleteCovertOps]
autoTrigger: if numberOfUnitsInTeam(withTag='CovertOps',withinRange=100,lessThan=1) and self.tags(includes='ScienceFacilityCO')
temporarilyRemoveTags: ScienceFacilityCO

[graphics]
image: scienceFacility.png
image_back:   NONE
image_wreak:ROOT:/DATA/Terran/dead2.png
image_turret: NONE
rotate_with_direction:false
drawLayer:experimentals
image_shadow:shadow.png
image_shadow_frames:true
shadowOffsetX:0
shadowOffsetY:0
frame_width:  128
frame_height: 96

[attack]
canAttack: false
canAttackFlyingUnits: false
canAttackLandUnits:   false
canAttackUnderwaterUnits: false
turretSize: 0
turretTurnSpeed: 6
maxAttackRange: 0
shootDelay: 80

[movement]
movementType: BUILDING
heightChangeRate: 6

[ai]
useAsBuilder:true
buildPriority: 0.09
noneInBaseExtraPriority: 0.09
noneGlobalExtraPriority: 0.09
maxEachBase: 2
maxGlobal: 2
recommendedInEachBaseNum: 1
upgradedFrom: buildScienceFacility

[animation_build]
body_0s: {frame:0}
body_0.2s: {frame:0}
body_0.4s: {frame:1}
body_0.6s: {frame:1}

[animation_air]
body_0s: {frame:2}
body_0.16s: {frame:3}
body_0.32s: {frame:4}
body_0.48s: {frame:5}
body_0.64s: {frame:6}
body_0.8s: {frame:6}
effect_0s: {name:NONE}
effect_0.1s: {name:CUSTOM|up,x:0,y:0}
effect_0.1006s: {name:CUSTOM|up_2,x:0,y:0}
effect_0.1005s: {name:CUSTOM|up_3,x:0,y:0}

[decal_grn_circle]
@copyFromSection: template_customSelectCircle
onlyWhenSelectedByOwnPlayer:true
image:ROOT:/DATA/total/circle_bldng_grn_2.png
yOffsetAbsolute:5

[decal_red_circle]
@copyFromSection: template_customSelectCircle
onlyWhenSelectedByEnemyPlayer:true
image:ROOT:/DATA/total/circle_bldng_red_2.png
yOffsetAbsolute:5

[decal_yellow_circle]
@copyFromSection: template_customSelectCircle
onlyWhenSelectedByAllyNotOwnPlayer:true
image:ROOT:/DATA/total/circle_bldng_yell_2.png
yOffsetAbsolute:5

[decal_hp]
@copyFromSection: template_customBar
@define totalFrames:35
image:ROOT:/DATA/total/hp_36.png
frame_width:109
frame_height:5
frame:int((self.hp*100/self.maxHp)/(100/${totalFrames}))
yOffsetAbsolute:54