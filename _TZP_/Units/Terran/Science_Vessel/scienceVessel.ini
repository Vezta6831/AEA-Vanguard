[core]
copyFrom:ROOT:/DATA/total/forcesAttack.template, ROOT:/DATA/Terran/terranUpgrades.template, ROOT:/DATA/total/debuffs.template, ROOT:/DATA/total/customUI.template
name: scienceVesselt
tags:detector,mech,L,haveEnergy,unit
class: CustomUnitMetadata
price:Gas=850
maxHp: 2100
armour:1
mass: 500
energyMax: 200
energyRegen:0.01
energyStartingPercentage:0.25
displayText_ru: Научное судно
displayText: Science vessel
displayDescription_ru: ДЕТЕКТОР
displayDescription: -Detects cloaked units\n-Heavy Support craft\n-No basic attack\n-Can give units a heavy shield\n-Can irradiate units, inflicting AOE damage\n- Can launch EMP, depleting energy and shields of affected targets
techLevel: 1
buildSpeed: 50s
#availableInDemo: true
radius: 26
displayRadius: 28
isBio: true
fogOfWarSightRange:17
hideScorchMark: false
isBug: false
isUnrepairableUnit: false
softCollisionOnAll: 250
effectOnDeath:CUSTOM:corpse
soundOnMoveOrder:rv_order.ogg:0.3,rv_order2.ogg:0.3,rv_order3.ogg:0.3,rv_order4.ogg:0.3
soundOnAttackOrder:rv_order.ogg:0.3,rv_order2.ogg:0.3,rv_order3.ogg:0.3,rv_order4.ogg:0.3
soundOnNewSelection:rv_order.ogg:0.3,rv_order2.ogg:0.3,rv_order3.ogg:0.3,rv_order4.ogg:0.3
ignoreInUnitCapCalculation: true

autoRepair: true
isBuilder: true
canRepairBuildings: true
canRepairUnits: true

nanoRange: 280
nanoBuildSpeed: 1.75
nanoRepairSpeed: 0.76


[effect_corpse]
alwayStartDirAtZero:true
attachedToUnit: false
life: 90
alpha: 9
image:ROOT:/DATA/Terran/units/death.png
priority: critical
drawUnderUnits:false
animateFrameStart:0
animateFrameEnd:8
animateFrameSpeed:0.2
alsoPlaySound:death.wav
frame_width:  128
frame_height: 128

[hiddenAction_soundOnCreate]
autoTriggerOnEvent: created
playSoundToPlayer:spawn.wav
requireConditional:if self.customTarget1!=nullUnit
addWaypoint_type:move
addWaypoint_target_fromReference: customTarget1.readUnitMemory(name="rally",type="unit")

[effect_smoke]
alwayStartDirAtZero:true
attachedToUnit: false
life: 80
alpha: 8
hSpeed: 0
image:ROOT:/DATA/Terran/units/smoke.png
priority: critical
drawUnderUnits:false
total_frames:8
animateFrameStart:0
animateFrameEnd:7
animateFrameSpeed:0.2
scaleFrom:1
scaleTo:1

[effect_emp]
alwayStartDirAtZero:true
attachedToUnit: false
life: 70
alpha: 7
hSpeed: 0
image:emp.png
priority: critical
drawUnderUnits:false
total_frames:7
animateFrameStart:0
animateFrameEnd:6
animateFrameSpeed:0.2
frame_width:  252
frame_height: 252

[hiddenAction_armor]
autoTrigger: if self.resource(type='TerranAirArmor',greaterThan=0) and not self.tags(includes='armor1')
temporarilyAddTags: armor1
setUnitStats: armour+=1

[hiddenAction_armor_2]
autoTrigger: if self.resource(type='TerranAirArmor',greaterThan=1) and not self.tags(includes='armor2')
temporarilyAddTags: armor2
setUnitStats: armour+=1

[hiddenAction_armor_3]
autoTrigger: if self.resource(type='TerranAirArmor',greaterThan=2) and not self.tags(includes='armor3')
temporarilyAddTags: armor3
setUnitStats: armour+=1

[hiddenAction_maxEnergy]
autoTrigger: if self.globalTeamTags(includes='TitanReactor') and not self.tags(includes='maxEnergy')
temporarilyAddTags: maxEnergy
setUnitStats: maxEnergy=250, energy=62

[action_Convert1]
ai_isHighPriority: if self.resource.uranium < 25000
text: Convert Minerals
description: - Convert Minerals to Vespene Gas\n- 1200 credits to 500 Uranium
isGuiBlinking: true
buildSpeed: 15s
price: Minerals=1200
addResources:Gas:500

[action_Convert2]
ai_isHighPriority: if self.resource.uranium < 25000
text: Convert Minerals
description: - Convert Minerals to Vespene Gas\n- 1200 credits to 500 Uranium
isGuiBlinking: true
buildSpeed: 15s
price: Gas=500
addResources:Minerals:1200

[action_defensiveMatrix]
isActive: if self.resource.lockdown<=0 and self.resource.stasis<=0
price:energy=75
buildSpeed:0s
text_ru:Защитная матрица
text:Defensive matrix
onlyOneUnitAtATime: true
fireTurretXAtGround:null
fireTurretXAtGround_withProjectile:null
ai_isDisabled: true
iconImage:defensive_matrix_icon.png
addResources:energy=75
alsoTriggerAction:defensive_matrix_2
alsoTriggerOrQueueActionConditional: if (thisActionTarget.nearestUnit(withinRange=50, withTag='S', relation='any') == thisActionTarget.nearestUnit(withinRange=50,relation='any') or thisActionTarget.nearestUnit(withinRange=50, withTag='L', relation='any') == thisActionTarget.nearestUnit(withinRange=50,relation='any') or thisActionTarget.nearestUnit(withinRange=50, withTag='M', relation='any') == thisActionTarget.nearestUnit(withinRange=50,relation='any')) and thisActionTarget.nearestUnit(withinRange=50,relation='any') != nullUnit

[hiddenAction_defensive_matrix_2]
requireConditional: if thisActionTarget.nearestUnit(withinRange=50).teamId==self.teamId and thisActionTarget.nearestUnit(withinRange=50)!=self
addResources:energy=-75
playSoundAtUnit:defensiveMatrix.ogg:0.3
playAnimation:attack
takeResources: d_matrix=-57
takeResources_includeUnitsWithinRange: 10000
takeResources_discardCollected: true
takeResources_includeReference: unitRef thisActionTarget.nearestUnit(withinRange=50)

[action_EMP]
price:energy=100
isVisible: if self.globalTeamTags(includes='EMPupgrade')
isActive: if self.resource.lockdown<=0 and self.resource.stasis<=0
buildSpeed:0s
text_ru:ЭМИ
text:EMP
fireTurretXAtGround:EMP
fireTurretXAtGround_withProjectile:EMP
whenBuilding_cannotMove:true
onlyOneUnitAtATime: true
ai_isDisabled: true
iconImage:ROOT:/DATA/Terran/emp.png
playSoundAtUnit:emp.ogg:0.4
playAnimation:attack

[action_irradiate]
alwaysSinglePress:true
price:energy=75
isVisible: if self.globalTeamTags(includes='Radiation')
isActive: if self.resource.lockdown<=0 and self.resource.stasis<=0
buildSpeed:0s
text_ru:Облучение
text:Irradiate
onlyOneUnitAtATime: true
fireTurretXAtGround:null
fireTurretXAtGround_withProjectile:null
ai_isDisabled: true
iconImage:ROOT:/DATA/Terran/irradiate.png
addResources:energy=75
alsoTriggerAction:irradiate_2
alsoTriggerOrQueueActionConditional: if (thisActionTarget.nearestUnit(withinRange=50, withTag='bio', relation='any') != nullUnit or thisActionTarget.nearestUnit(withinRange=50, withTag='mech', relation='any') != nullUnit) or (thisActionTarget.nearestUnit(withinRange=50, withTag='mech', relation='any') != self and thisActionTarget.nearestUnit(withinRange=50, withTag='mech', relation='any') != thisActionTarget.nearestUnit(withinRange=50, withTag='building', relation='any'))

[hiddenAction_irradiate_2]
addResources:energy=-75
playSoundAtUnit:irradiate.ogg:0.4
playAnimation:attack
fireTurretXAtGround_withTarget: thisActionTarget
fireTurretXAtGround:irradiate
fireTurretXAtGround_withProjectile:irradiate

[action_irradiate_ai]
alwaysSinglePress:true
price:energy=75
isVisible: if self.globalTeamTags(includes='Radiation') and self.isControlledByAI()
isActive: if self.globalTeamTags(includes='Radiation') and nearestUnit(withinRange=310, withTag='bio', relation='enemy') != nullUnit and self.resource.lockdown<=0 and self.resource.stasis<=0
buildSpeed:0s
text_ru:Облучение
text:Irradiate
onlyOneUnitAtATime: true
fireTurretXAtGround:irradiate
fireTurretXAtGround_withProjectile:irradiate
fireTurretXAtGround_withTarget: nearestUnit(withinRange=320, withTag='bio', relation='enemy')
playSoundAtUnit:irradiate.ogg:0.4
ai_isHighPriority: true
iconImage:ROOT:/DATA/Terran/irradiate.png

[graphics]
image_offsetY:0
icon_build: scienceVessel_icon.png
image:  scienceVessel.png
image_wreak:  NONE
image_turret: NONE
image_shadow: AUTO_ANIMATED
rotate_with_direction: false
animation_direction_units: 45
animation_direction_strideX:3
animation_direction_strideY:0
animation_direction_starting:180
frame_width:  96
frame_height: 128
lock_body_rotation_with_main_turret: true

[attack]
canAttack: true
canAttackFlyingUnits: false
canAttackLandUnits:   false
canAttackUnderwaterUnits: false
isFixedFiring: true
stopTargetingAfterFiring: true
aimOffsetSpread: 0
turretSize: 10
turretTurnSpeed: 3
maxAttackRange: 320
shootDelay: 1s
showRangeUIGuide:false

[turret_null]
x: 0
y: 0
limitingRange:320
canShoot: false
projectile:null

[projectile_null]
life:0
speed:0
invisible: true
directDamage: 0
explodeEffect:NONE
explodeEffectOnShield:NONE

[turret_irradiate]
x: 0
y: 0
limitingRange:320
canShoot: false
onShoot_freezeBodyMovementFor:0.8s
projectile:irradiate
barrelHeight: -10

[projectile_irradiate]
life: 10
instant: true
invisible: true
directDamage: 0
targetGround: true
explodeEffect:NONE
explodeEffectOnShield:NONE
spawnUnit:irradiate

[turret_EMP]
x: 0
y: 0
limitingRange:320
canShoot: false
onShoot_freezeBodyMovementFor:0.8s
projectile:EMP
barrelHeight: -10

[projectile_EMP]
life: 240
speed: 4
targetSpeed: 8
areaDamage: 0
areaRadius: 120
targetGround: true
image:ROOT:/DATA/Terran/units/rocket.png
trailEffect:CUSTOM:smoke
trailEffectRate:6
explodeEffect:CUSTOM:emp
explodeEffectOnShield:CUSTOM:emp
mutator1_ifUnitWithTags:haveEnergy
mutator1_addResourcesAreaHit: energy=-9999
mutator2_ifUnitWithTags:haveShield
mutator2_addResourcesAreaHit: shield=-9999
areaHitAirAndLandAtSameTime: true
friendlyFire: true

[movement]
movementType: AIR
moveSpeed: 0.84
moveAccelerationSpeed: 0.03
moveDecelerationSpeed: 0.02
maxTurnSpeed: 40
turnAcceleration: 40
reverseSpeedPercentage:0
joinsGroupFormations: false
slowDeathFallSmoke: false
slowDeathFall: false
startingHeightOffset: 35

[ai]
buildPriority: 0.8
noneInBaseExtraPriority: 0.8
noneGlobalExtraPriority: 0.8
maxGlobal: 2

[animation_attack]
body_0s: {frame:0}
body_0.1s: {frame:1}
body_0.2s: {frame:2}
body_0.3s: {frame:2}
body_0.35s: {frame:1}
body_0.4s: {frame:0}
body_0.5s: {frame:1}
body_0.6s: {frame:2}
body_0.7s: {frame:2}
body_0.75s: {frame:1}
body_0.8s: {frame:0}
body_0.9s: {frame:1}
body_1s: {frame:2}
body_1.1s: {frame:2}
body_1.15s: {frame:1}
body_1.2s: {frame:0}
body_1.3s: {frame:0}

[resource_irradiate]
hidden:false

[decal_ensnare_goo]
image:ROOT:/DATA/total/ensnare_goo_3.png

[decal_plague_goo]
image:ROOT:/DATA/total/plague_goo_3.png

[decal_defensive_matrix]
image:ROOT:/DATA/total/defensive_matrix_3.png

[decal_lockdown]
image:ROOT:/DATA/total/lockdown_3.png

[effect_mindControl]
image:ROOT:/DATA/total/mindControl_3.png
frame_width: 128
frame_height: 128

[effect_feedback]
image:ROOT:/DATA/total/feedback_2.png
frame_width: 128
frame_height: 128

[hiddenAction_debuff_maelstrom]
@copyFrom_skipThisSection: true

[hiddenAction_debuff_maelstrom_effect]
@copyFrom_skipThisSection: true

[hiddenAction_removeDebuff_maelstrom]
@copyFrom_skipThisSection: true

[decal_grn_circle]
@copyFromSection: template_customSelectCircle
onlyWhenSelectedByOwnPlayer:true
image:ROOT:/DATA/total/circle_lrg_grn.png

[decal_red_circle]
@copyFromSection: template_customSelectCircle
onlyWhenSelectedByEnemyPlayer:true
image:ROOT:/DATA/total/circle_lrg_red.png

[decal_yellow_circle]
@copyFromSection: template_customSelectCircle
onlyWhenSelectedByAllyNotOwnPlayer:true
image:ROOT:/DATA/total/circle_lrg_yell.png

[decal_hp]
@copyFromSection: template_customBar
@define totalFrames:16
image:ROOT:/DATA/total/hp_17.png
frame_width:52
frame_height:5
frame:int((self.hp*100/self.maxHp)/(100/${totalFrames}))
yOffsetAbsolute:33

[decal_energy]
@copyFromSection: template_customBar
@define totalFrames:17
onlyWhenSelectedByOwnPlayer:true
onlyWhenSelectedByAnyPlayer:false
image:ROOT:/DATA/total/energy_17.png
frame_width:52
frame_height:5
frame:int((self.energy*100/self.maxEnergy)/(100/${totalFrames}))
yOffsetAbsolute:39