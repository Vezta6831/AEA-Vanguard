[core]
copyFrom:ROOT:/DATA/total/baseAttack.template, ROOT:/DATA/total/debuffs.template, ROOT:/DATA/Terran/buildings.template, ROOT:/DATA/total/customUI.template
name: Bunker
tags:Bunker,building,mech
class: CustomUnitMetadata
price: 0
maxHp: 2600
mass: 9000
armour:4
hideScorchMark: false
fogOfWarSightRange:17
displayText_ru:Бункер
displayText:Bunker
displayDescription: -Stores infantry inside\n-Infantry can attack while inside
maxTransportingUnits:6
transportUnitsRequireTag:bunkerBio
transportUnitsUnloadDelayBetweenEachUnit: 0
footprint: -2,-1,1,1
constructionFootprint:-2,-1,1,1
buildingToFootprintOffsetX:0
buildingToFootprintOffsetY:10
exit_x:0
exit_y:40
exit_moveAwayAmount:0
techLevel: 1
buildSpeed: 1
selfBuildRate: 1
radius: 50
isBuilder: true
nanoRange: 0
isBuilding: true
isBio: true
numBitsOnDeath: 12
isUnrepairableUnit:false
effectOnDeath:CUSTOM:corpse

[action_unload_slot1]
@define slotId: 0
alwaysSinglePress:true
isVisible: if transporting(slot=${slotId})!=nullUnit
isActive: if transporting(slot=${slotId})!=nullUnit
forceUnloadTransportNow: true
forceUnloadTransportNow_onlyOnSlot: ${slotId}
price: 0
text: [
textAddUnitName: unitRef transporting(slot=${slotId})
textPostFix: ]
unitShownInUI: unitRef transporting(slot=${slotId})
buildSpeed: 0s
allowMultipleInQueue:false
highPriorityQueue: true
ai_isDisabled:true

[action_unload_slot2]
@define slotId: 1
@copyFromSection: action_unload_slot1

[action_unload_slot3]
@define slotId: 2
@copyFromSection: action_unload_slot1

[action_unload_slot4]
@define slotId: 3
@copyFromSection: action_unload_slot1

[effect_corpse]
alwayStartDirAtZero:true
attachedToUnit: false
life: 120
alpha: 12
image:ROOT:/DATA/Terran/death.png
alsoPlaySound:ROOT:/DATA/total/buildingExplode.wav
priority: critical
drawUnderUnits:false
animateFrameStart:0
animateFrameEnd:11
animateFrameSpeed:0.2
frame_width:  252
frame_height: 200

[attachment_0]
x: 0
y: 0
canBeAttackedAndDamaged:false
deattachIfWantingToMove:false
isVisible:true
isUnselectable:true
addTransportedUnits:true
idleDir: 0
rotateWithParent: false
lockRotation:false
canAttack:true
keepAliveWhenParentDies:true
setDrawLayerOnTop:true
smoothlyBlendPositionWhenExistingUnitAdded:false

[attachment_1]
@copyFromSection: attachment_0

[attachment_2]
@copyFromSection: attachment_0

[attachment_3]
@copyFromSection: attachment_0

[action_clear]
isVisible:true
isActive:true
buildSpeed:1s
price:0
text_ru:Уничтожить
text:Delete
iconImage:ROOT:/DATA/total/delete.png
addResources:hp=-1500
ai_isDisabled:true

[decal_fire]
@copyFromSection: template_fire
isVisible: if self.hp<self.maxHp*0.85
image:ROOT:/DATA/Terran/fire2.png
frame: select(self.hp<self.maxHp*0.7,12,0)+(self.timeAlive*12%12)
xOffsetAbsolute:-26
yOffsetAbsolute:-15

[decal_fire_2]
@copyFromSection: template_fire
isVisible: if self.hp<self.maxHp*0.55
image:ROOT:/DATA/Terran/fire.png
frame: select(self.hp<self.maxHp*0.4,12,0)+(self.timeAlive*12%12)
xOffsetAbsolute:9
yOffsetAbsolute:-20

[hiddenAction_AIBunker]
autoTrigger: if self.transportingCount(lessThan=4) and self.isControlledByAI() and not self.tags(includes='BunkerAI')
temporarilyAddTags:BunkerAI

[hiddenAction_AIBunker_2]
autoTrigger: if self.transportingCount(greaterThan=3) and self.isControlledByAI() and self.tags(includes='BunkerAI')
temporarilyRemoveTags:BunkerAI

[hiddenAction_soundOnLoad]
autoTriggerOnEvent: transportingNewUnit
playSoundAtUnit: ROOT:/DATA/Terran/units/load.ogg:0.4

[hiddenAction_soundOnUnload]
autoTriggerOnEvent: transportUnloadedOrRemovedUnit
playSoundAtUnit: ROOT:/DATA/Terran/units/unload.ogg:0.4

[graphics]
#image_offsetY:-2
total_frames: 1
imageScale: 1
image: bunker.png
image_back:   NONE
image_wreak:ROOT:/DATA/Terran/dead.png
image_turret: NONE
drawLayer:experimentals
showTransportBar:false
image_shadow:shadow.png
shadowOffsetX:3
shadowOffsetY:1

[attack]

canAttack: true
canAttackFlyingUnits: true
canAttackLandUnits:   true
canAttackUnderwaterUnits: false

isFixedFiring: false

turretSize: 6
turretTurnSpeed: 3

maxAttackRange: 285
showRangeUIGuide:true

[movement]
movementType: BUILDING

[ai]
buildPriority: 0.09
noneInBaseExtraPriority: 0.09
noneGlobalExtraPriority: 0.09
maxEachBase: 1
recommendedInEachBaseNum: 1
#maxGlobal: 0
upgradedFrom: buildBunker

[decal_grn_circle]
@copyFromSection: template_customSelectCircle
onlyWhenSelectedByOwnPlayer:true
image:ROOT:/DATA/total/circle_lrg_grn_2.png

[decal_red_circle]
@copyFromSection: template_customSelectCircle
onlyWhenSelectedByEnemyPlayer:true
image:ROOT:/DATA/total/circle_lrg_red_2.png

[decal_yellow_circle]
@copyFromSection: template_customSelectCircle
onlyWhenSelectedByAllyNotOwnPlayer:true
image:ROOT:/DATA/total/circle_lrg_yell_2.png

[decal_hp]
@copyFromSection: template_customBar
@define totalFrames:23
image:ROOT:/DATA/total/hp_24.png
frame_width:73
frame_height:5
frame:int((self.hp*100/self.maxHp)/(100/${totalFrames}))
yOffsetAbsolute:35