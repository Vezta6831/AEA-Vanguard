[core]
copyFrom:ROOT:/DATA/total/forcesAttack.template, ROOT:/DATA/Protoss/protossUpgrades.template, ROOT:/DATA/total/debuffs.template, ROOT:/DATA/total/customUI.template
name:probe
tags: probe, builder, S, NotBroodling, unit, AiBuilder,haveShield, hover, mech
showActionsWithMixedSelectionIfOtherUnitsHaveTag:builder
logIfCreditResourceUsed:true
class: CustomUnitMetadata
price:Gas=55
maxHp: 300
maxShield:250
shieldRegen:0.06
startShieldAtZero:false
shieldDisplayOnlyDeflection:true
mass: 500
displayText_ru: Зонд
displayText: Probe
displayDescription: -Basic robot slave of the protoss\n-Harvests resources and builds buildings
techLevel: 1
buildSpeed: 15s
#availableInDemo: true
radius: 12
displayRadius: 14
isBio: true
hideScorchMark: false
isBug: false
isBuilder: true
isUnrepairableUnit: false
softCollisionOnAll: 50
fogOfWarSightRange:17
nanoRange: 50
canReclaimResources: true
nanoRangeForReclaim:20
nanoRangeForReclaimIsMelee:true
transportSlotsNeeded: 1
effectOnDeath:CUSTOM:corpse
soundOnMoveOrder:probeOrder.ogg:0.3,probeOrder2.ogg:0.3,probeOrder3.ogg:0.3
soundOnNewSelection:probeOrder.ogg:0.3,probeOrder2.ogg:0.3,probeOrder3.ogg:0.3
ignoreInUnitCapCalculation: true


[action_basicStructure]
pos:-1
price:0
buildSpeed:0
text_ru: Базовые
text: Basic
isVisible: if self.resource(type='select',equalTo=0)
isActive: if self.resource(type='select',equalTo=0)
resourceAmount: select
resourceAmount_setValue: 1
iconImage:ROOT:/DATA/Protoss/basicStructure.png
alwaysSinglePress:true

[action_advancesStructure]
pos:-1
price:0
buildSpeed:0
text_ru: Продвинутые
text: Advanced
isVisible: if self.resource(type='select',equalTo=0)
isActive: if self.resource(type='select',equalTo=0)
resourceAmount: select
resourceAmount_setValue: 2
iconImage:ROOT:/DATA/Protoss/advancedStructure.png
alwaysSinglePress:true

[action_cancel]
pos:-1
price:0
buildSpeed:0
text_ru: Отмена
text: Cancel
isVisible: if self.resource(type='select',greaterThan=0)
isActive: if self.resource(type='select',greaterThan=0)
resourceAmount: select
resourceAmount_setValue: 0
iconImage:ROOT:/DATA/total/cancel.png
alwaysSinglePress:true

[canBuild_1]
name: buildNexus
isVisible: if self.resource(type='select',equalTo=1) or (self.isControlledByAI() and not self.globalTeamTags(includes='Campaign'))

[canBuild_2]
name: buildPylon
isVisible: if self.resource(type='select',equalTo=1) or (self.isControlledByAI() and not self.globalTeamTags(includes='Campaign'))

[canBuild_3]
name: buildAssimilator
isVisible: if self.resource(type='select',equalTo=1) or (self.isControlledByAI() and not self.globalTeamTags(includes='Campaign'))

[canBuild_4]
name:buildPhotonCannon
isLocked: if not self.hasUnitInTeam(withTag='Forge')
isLockedMessage_ru:Требуется:\n  >Оружейная
isLockedMessage:Requires:\n  >Forge
isVisible: if self.resource(type='select',equalTo=1) or (self.isControlledByAI() and not self.globalTeamTags(includes='Campaign'))

[canBuild_5]
name:buildShieldBattery
isLocked: if not self.hasUnitInTeam(withTag='Gateway')
isLockedMessage_ru:Требуется:\n  >Врата
isLockedMessage:Requires:\n  >Gateway
isVisible: if self.resource(type='select',equalTo=1) and not self.globalTeamTags(includes='ShieldBatteryLocked') or (self.isControlledByAI() and not self.globalTeamTags(includes='Campaign'))

[canBuild_6]
name:buildGateway
isVisible: if self.resource(type='select',equalTo=1) or (self.isControlledByAI() and not self.globalTeamTags(includes='Campaign'))

[canBuild_7]
name:buildForge
isVisible: if self.resource(type='select',equalTo=1) or (self.isControlledByAI() and not self.globalTeamTags(includes='Campaign'))

[canBuild_8]
name:buildCybernaticsCore
isLocked: if not self.hasUnitInTeam(withTag='Gateway')
isLockedMessage_ru:Требуется:\n  >Врата
isLockedMessage:Requires:\n  >Gateway
isVisible: if self.resource(type='select',equalTo=1) or (self.isControlledByAI() and not self.globalTeamTags(includes='Campaign'))

[canBuild_9]
name:buildStarGate
isVisible: if self.resource(type='select',equalTo=2) and not self.globalTeamTags(includes='StarGateLocked') or (self.isControlledByAI() and not self.globalTeamTags(includes='Campaign'))

[canBuild_10]
name:buildTemplarArchive
isLocked: if not self.hasUnitInTeam(withTag='CitadelOfAdun')
isLockedMessage_ru:Требуется:\n  >Цитадель Адуна
isLockedMessage:Requires:\n  >Citadel of Adun
isVisible: if self.resource(type='select',equalTo=2) and not self.globalTeamTags(includes='TemplarArchiveLocked') or (self.isControlledByAI() and not self.globalTeamTags(includes='Campaign'))

[canBuild_11]
name:buildCitadelOfAdun
isLocked: if not self.hasUnitInTeam(withTag='CybernaticsCore')
isLockedMessage_ru:Требуется:\n  >Кибернетическое ядро
isLockedMessage:Requires:\n  >Cybernatics core
isVisible: if self.resource(type='select',equalTo=2) and not self.globalTeamTags(includes='CitadelOfAdunLocked') or (self.isControlledByAI() and not self.globalTeamTags(includes='Campaign'))

[canBuild_12]
name:buildObservatory
isLocked: if not self.hasUnitInTeam(withTag='RoboFacility')
isLockedMessage_ru:Требуется:\n  >Завод робототехники
isLockedMessage:Requires:\n  >Robotics facility
isVisible: if self.resource(type='select',equalTo=2) and not self.globalTeamTags(includes='ObservatoryLocked') or (self.isControlledByAI() and not self.globalTeamTags(includes='Campaign'))

[canBuild_13]
name:buildRoboFacility
isLocked: if not self.hasUnitInTeam(withTag='CybernaticsCore')
isLockedMessage_ru:Требуется:\n  >Кибернетическое ядро
isLockedMessage:Requires:\n  >Cybernatics core
isVisible: if self.resource(type='select',equalTo=2) and not self.globalTeamTags(includes='RoboFacilityLocked') or (self.isControlledByAI() and not self.globalTeamTags(includes='Campaign'))

[canBuild_14]
name:buildRoboFacilitySupport
isLocked: if not self.hasUnitInTeam(withTag='RoboFacility')
isLockedMessage_ru:Требуется:\n  >Завод робототехники
isLockedMessage:Requires:\n  >Robotics facility
isVisible: if self.resource(type='select',equalTo=2) and not self.globalTeamTags(includes='RoboFacilitySupportLocked') or (self.isControlledByAI() and not self.globalTeamTags(includes='Campaign'))

[canBuild_15]
name:buildFleetBeacon
isLocked: if not self.hasUnitInTeam(withTag='StarGate')
isLockedMessage_ru:Требуется:\n  >Звёздные врата
isLockedMessage:Requires:\n  >Stargate
isVisible: if self.resource(type='select',equalTo=2) and not self.globalTeamTags(includes='FleetBeaconLocked') or (self.isControlledByAI() and not self.globalTeamTags(includes='Campaign'))

[canBuild_16]
name:buildArbiterTribunal
isLocked: if not self.hasUnitInTeam(withTag='TemplarArchive') or not self.hasUnitInTeam(withTag='StarGate')
isLockedMessage_ru:Требуется:\n  >Звёздные врата\n  >Архивы тамплиеров
isLockedMessage:Requires:\n  >Stargate\n  >Templar archives
isVisible: if self.resource(type='select',equalTo=2) and not self.globalTeamTags(includes='ArbiterTribunalLocked') or (self.isControlledByAI() and not self.globalTeamTags(includes='Campaign'))

[hiddenAction_Recall]
autoTrigger: if numberOfUnitsInTeam(withTag='recall',withinRange=100,greaterThan=0) and nearestUnit(withinRange=120, withTag='recall', relation='own').customTarget1!=nullUnit
clearAllWaypoints: true
teleportTo: nearestUnit(withinRange=120, withTag='recall', relation='own').customTarget1

[hiddenAction_move]
autoTrigger: if numberOfUnitsInTeam(withTag='buildingPortal',withinRange=40,greaterThan=0) and not self.hasActiveWaypoint(type='build') and not self.hasActiveWaypoint(type='move') and not self.hasActiveWaypoint(type='attack')
addWaypoint_type: move
addWaypoint_prepend: true
addWaypoint_position_randomOffsetFromSelf:55,55
addWaypoint_maxTime: 2s

[hiddenAction_move_2]
autoTrigger: if numberOfUnitsInTeam(withTag='buildingPortalSmall',withinRange=30,greaterThan=0) and not self.hasActiveWaypoint(type='build') and not self.hasActiveWaypoint(type='move') and not self.hasActiveWaypoint(type='attack')
addWaypoint_type: move
addWaypoint_prepend: true
addWaypoint_position_randomOffsetFromSelf:55,55
addWaypoint_maxTime: 2s

[effect_light]
alwayStartDirAtZero:true
attachedToUnit: false
showInFog:false
life: 70
alpha: 7
image: light.png
priority: critical
drawUnderUnits:false
total_frames:7
animateFrameStart:0
animateFrameEnd:6
animateFrameSpeed:0.2
scaleFrom:1
scaleTo: 1
yOffsetRelative:28
alsoPlaySound:reclaim.ogg:0.55

[hiddenAction_soundOnCreate]
autoTriggerOnEvent: created
playSoundToPlayer:spawn.wav
requireConditional:if self.customTarget1!=nullUnit
addWaypoint_type:move
addWaypoint_target_fromReference: customTarget1.readUnitMemory(name="rally",type="unit")

[effect_corpse]
alwayStartDirAtZero:true
attachedToUnit: false
life: 130
alpha: 13
image: ROOT:/DATA/Protoss/units/death.png
priority: critical
drawUnderUnits: true
total_frames:13
animateFrameStart:0
animateFrameEnd:12
animateFrameSpeed:0.2
frame_width:  78
frame_height: 65
alsoPlaySound:dead.ogg

[hiddenAction_moveToHarvest]
autoTrigger: if not self.hasActiveWaypoint(type="reclaim") and not self.hasActiveWaypoint(type="touchTarget") and not self.hasActiveWaypoint(type="build") and self.isControlledByAI() and self.globalTeamTags(includes='Campaign')
addWaypoint_type: reclaim
addWaypoint_target_nearestUnit_tagged: resources
addWaypoint_target_nearestUnit_team: neutral
clearAllWaypoints:true

[hiddenAction_moveToUnload]
autoTrigger: if self.hasActiveWaypoint(type='reclaim') and self.hasResources(localMinerals=8)
addWaypoint_type: touchTarget
addWaypoint_prepend: true
addWaypoint_target_nearestUnit_tagged: resourceDropoff
addWaypoint_target_nearestUnit_team: own
addWaypoint_triggerActionIfFailed: findFailed
convertTo:probe2

[hiddenAction_moveToUnload_2]
autoTrigger: if self.hasActiveWaypoint(type='reclaim') and self.hasResources(localGas=8)
addWaypoint_type: touchTarget
addWaypoint_prepend: true
addWaypoint_target_nearestUnit_tagged: resourceDropoff
addWaypoint_target_nearestUnit_team: own
addWaypoint_triggerActionIfFailed: findFailed
convertTo:probe3

[hiddenAction_moveToUnload_3]
autoTrigger: if self.hasActiveWaypoint(type='reclaim') and self.hasResources(localGas2=8)
addWaypoint_type: touchTarget
addWaypoint_prepend: true
addWaypoint_target_nearestUnit_tagged: resourceDropoff
addWaypoint_target_nearestUnit_team: own
addWaypoint_triggerActionIfFailed: findFailed
convertTo:probe3

[hiddenAction_findFailed]
clearActiveWaypoint: true

[hiddenAction_unload]
autoTriggerOnEvent: touchTargetSuccess
alsoTriggerAction: unloadMinerals, unloadGas, unloadGas2

[hiddenAction_unloadMinerals]
requireConditional:if self.hasResources(localMinerals=8)
addResources: localMinerals=-8
addResourcesScaledByAIHandicaps:Minerals=8
convertTo:probe

[hiddenAction_unloadGas]
requireConditional:if self.hasResources(localGas=8)
addResources: localGas=-8
addResourcesScaledByAIHandicaps:Gas=8
convertTo:probe
alsoTriggerAction: aiBoost

[hiddenAction_unloadGas2]
requireConditional:if self.hasResources(localGas2=8)
addResources: localGas2=-8
addResourcesScaledByAIHandicaps:Gas=2
convertTo:probe
alsoTriggerAction: aiBoost

[hiddenAction_aiBoost]
requireConditional: if self.isControlledByAI()
addResourcesScaledByAIHandicaps: Gas=4

[graphics]
image_offsetY:-8
frame_width:  60
frame_height: 50
total_frames: 1
icon_build: probe_icon.png
image:        probe.png
image_wreak:  NONE
image_turret: NONE
image_shadow: AUTO_ANIMATED
shadowOffsetX:0
shadowOffsetY:2
drawLayer:experimentals
reclaimEffect: NONE
rotate_with_direction: false
animation_direction_units: 45
animation_direction_strideX:0
animation_direction_strideY:1
animation_direction_starting:180

[attack]
aimOffsetSpread:0
canAttack: true
canAttackFlyingUnits: false
canAttackLandUnits: true
canAttackUnderwaterUnits: false
isFixedFiring: true
disablePassiveTargeting:true
turretSize: 10
maxAttackRange: 15
shootDelay: 0.924s
meleeEngangementDistance: 120
isMelee:true
showRangeUIGuide:true

[turret_1]
canAttackCondition: if numberOfUnitsInNeutralTeam(withTag='disruptionWeb',withinRange=120)<=0
x: 0
y: 0
recoilOffset: 0
showRangeUIGuide:false
projectile: 1

[turret_nano]
x: 0
y: 0
size:22
isMainNanoTurret:true
canShoot:false
showRangeUIGuide:false

[projectile_1]
explodeEffect:NONE
directDamage: 15
life: 10
instant:true
invisible: true

[movement]
movementType: LAND
moveSpeed: 1.488
moveAccelerationSpeed: 0.04
moveDecelerationSpeed: 0.04
maxTurnSpeed: 20
turnAcceleration: 20
reverseSpeedPercentage:0
joinsGroupFormations: false

[animation_harvest]
onActions: reclaim
body_0s: {frame:0}
body_0.6s: {frame:0}
effect_0s: {name:NONE}
effect_0.1s: {name:CUSTOM|light,x:0,y:0}

[animation_attack]
onActions: attack
body_0s: {frame:0}
body_0.6s: {frame:0}
effect_0s: {name:NONE}
effect_0.1s: {name:CUSTOM|light,x:0,y:0}

[ai]
useAsBuilder: true
whenUsingAsHarvester_recommendedInEachBase: 16
onlyUseAsHarvester_ifBaseHasUnitTagged: resourceDropoff
buildPriority: 0.1
noneInBaseExtraPriority: 0.1
noneGlobalExtraPriority: 0.1
maxEachBase: 16

[hiddenAction_feedback_debuff]
@copyFrom_skipThisSection: true

[effect_feedback]
@copyFrom_skipThisSection: true

[hiddenAction_debuff_maelstrom]
@copyFrom_skipThisSection: true

[hiddenAction_debuff_maelstrom_effect]
@copyFrom_skipThisSection: true

[hiddenAction_removeDebuff_maelstrom]
@copyFrom_skipThisSection: true

[decal_grn_circle]
@copyFromSection: template_customSelectCircle
onlyWhenSelectedByOwnPlayer:true
image:ROOT:/DATA/total/circle_smll_grn_2.png

[decal_red_circle]
@copyFromSection: template_customSelectCircle
onlyWhenSelectedByEnemyPlayer:true
image:ROOT:/DATA/total/circle_smll_red_2.png

[decal_yellow_circle]
@copyFromSection: template_customSelectCircle
onlyWhenSelectedByAllyNotOwnPlayer:true
image:ROOT:/DATA/total/circle_smll_yell_2.png

[decal_hp]
@copyFromSection: template_customBar
@define totalFrames:6
image:ROOT:/DATA/total/hp_p7.png
frame_width:22
frame_height:7
frame:int((self.hp*100/self.maxHp)/(100/${totalFrames}))
yOffsetAbsolute:14

[decal_shield]
@copyFromSection: template_customBar
@define totalFrames:6
image:ROOT:/DATA/total/shield_p7.png
frame_width:22
frame_height:7
frame:int((self.shield*100/self.maxShield)/(100/${totalFrames}))
yOffsetAbsolute:14