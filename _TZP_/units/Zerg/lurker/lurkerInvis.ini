[core]
copyFrom:ROOT:/DATA/total/forcesAttack.template, ROOT:/DATA/Zerg/zergUpgrades.template, ROOT:/DATA/total/debuffs.template, ROOT:/DATA/total/customUI.template
showInEditor:false
disableAllUnitCollisions:true
name: lurkerInvis
tags:M,bio,invis,undergroundZerg,canConsume,unit
canOnlyBeAttackedByUnitsWithTags:massWeapons
class: CustomUnitMetadata
price: 0
maxHp: 1800
armour:1
mass: 500
displayText_ru: Скрытень
displayText: Lurker
techLevel: 1
buildSpeed: 0.005
#availableInDemo: true
radius: 16
hideScorchMark: true
displayRadius: 18
isBio: true
isBug: false
isUnrepairableUnit: true
selfRegenRate:0.01
softCollisionOnAll: 12
fogOfWarSightRange:17
transportSlotsNeeded: 999
effectOnDeath:CUSTOM:corpse
soundOnMoveOrder: lurker_order.ogg:0.3,lurker_order2.ogg:0.3,lurker_order3.ogg:0.3,lurker_order4.ogg:0.3
soundOnAttackOrder: lurker_order.ogg:0.3,lurker_order2.ogg:0.3,lurker_order3.ogg:0.3,lurker_order4.ogg:0.3
soundOnNewSelection:lurker_order.ogg:0.3,lurker_order2.ogg:0.3,lurker_order3.ogg:0.3,lurker_order4.ogg:0.3
showOnMinimapToEnemies: false
autoTriggerCooldownTime: 0.1s


[hiddenAction_repairForMedic]
autoTrigger: if not self.hp(full=true) and not self.tags(includes='repairInfantry')
temporarilyAddTags:repairInfantry

[hiddenAction_notRepairForMedic]
autoTrigger: if self.hp(full=true) and self.tags(includes='repairInfantry')
temporarilyRemoveTags:repairInfantry

[hiddenAction_armor]
autoTrigger: if self.resource(type='ZergGroundCarapace',greaterThan=0) and not self.tags(includes='armor1')
temporarilyAddTags: armor1
setUnitStats: armour+=1

[hiddenAction_armor_2]
autoTrigger: if self.resource(type='ZergGroundCarapace',greaterThan=1) and not self.tags(includes='armor2')
temporarilyAddTags: armor2
setUnitStats: armour+=1

[hiddenAction_armor_3]
autoTrigger: if self.resource(type='ZergGroundCarapace',greaterThan=2) and not self.tags(includes='armor3')
temporarilyAddTags: armor3
setUnitStats: armour+=1

[hiddenAction_swarm]
isVisible:false
autoTrigger: if self.hasUnitInTeam(withTag='swarm',withinRange=120)
temporarilyAddTags: zergSwarm

[hiddenAction_notSwarm]
isVisible:false
autoTrigger: if not self.hasUnitInTeam(withTag='swarm',withinRange=120)
temporarilyRemoveTags: zergSwarm

[effect_cloud]
alwayStartDirAtZero:true
attachedToUnit: false
life: 70
alpha: 7
hSpeed: 0
image:ROOT:/DATA/Zerg/units/cloud.png
priority: critical
drawUnderUnits:false
total_frames:7
animateFrameStart:0
animateFrameEnd:6
animateFrameSpeed:0.2
scaleFrom:1
scaleTo: 1

[hiddenAction_clearAttacking]
autoTriggerOnEvent:newWaypointGivenByPlayer
requireConditional: if distanceBetween(self, self.activeWaypointTarget)>240
autoTrigger: if distanceBetween(self, self.activeWaypointTarget)>240
clearAllWaypoints:true

[action_burrow]
alwaysSinglePress:true
isVisible: true
isActive: if self.queueSize(equalTo=0) and self.resource.maelstrom<=0 and self.resource.stasis<=0
price: 0
pos: 0.1
buildSpeed: 0s
displayType:upgrade
text_ru: Выкопаться
text: Dig up
iconImage:ROOT:/DATA/Zerg/unburrow.png
playSoundAtUnit:ROOT:/DATA/Zerg/lurk2.ogg:0.3
isLocked: if self.isControlledByAI() and ((self.isAttacking() and distanceBetween(self, self.activeWaypointTarget)<=240) or self.isAttacking())
ai_isHighPriority: true
alsoQueueAction:burrow_2
allowMultipleInQueue:false
clearAllWaypoints:true
spawnEffects:CUSTOM:cloud

[hiddenAction_burrow_2]
convertTo: lurker
buildSpeed: 0.3s
highPriorityQueue: true
whenBuilding_temporarilyConvertTo: lurkerVis
whenBuilding_playAnimation:burrow
whenBuilding_cannotMove:true
whenBuilding_rotateTo:0
canPlayerCancel:false

[hiddenAction_detect]
autoTrigger: if (numberOfUnitsInEnemyTeam(withTag='detector',withinRange=400)>0 or numberOfUnitsInEnemyTeam(withTag='detectorRange',withinRange=460)>0 or self.resource.d_matrix>0 or self.resource.maelstrom>0 or self.resource.stasis>0 or self.resource.ensnare>0 or self.resource.plague>0) and self.queueSize<=0
convertTo: lurkerVis

[effect_corpse]
alwayStartDirAtZero:true
attachedToUnit: false
life: 60
alpha: 6
image: death.png
priority: critical
drawUnderUnits: true
total_frames:6
animateFrameStart:0
animateFrameEnd:5
animateFrameSpeed:0.2
alsoPlaySound:death.wav

[effect_spark]
alwayStartDirAtZero:true
attachedToUnit: false
life: 50
hSpeed: 0
alpha: 9
image: spark1.png
priority: critical
drawUnderUnits:false
total_frames:9
animateFrameStart:0
animateFrameEnd:8
animateFrameSpeed:0.3
scaleFrom:1
scaleTo: 1
createWhenOverLiquid:false
#alsoPlaySound:hit.ogg:0.3

[graphics]
isVisibleToEnemies: false
image_offsetY:-3
icon_build:ROOT:/DATA/Zerg/lurker_icon.png
image:        lurker2.png
image_wreak:  dead.png
image_turret: NONE
image_shadow: NONE
animation_moving_start: 0
animation_moving_end: 0
animation_moving_speed: 120
animation_idle_start: 0
animation_idle_end: 0
animation_idle_speed: 120
animation_attack_start: 0
animation_attack_end: 0
animation_attack_speed: 6
showEnergyBar: false
showShotDelayBar:false
lock_body_rotation_with_main_turret: true
drawLayer:experimentals
rotate_with_direction: false
frame_width: 62
frame_height: 54
imageScale: 1.3

[attack]
canAttack: true
canAttackFlyingUnits: false
canAttackLandUnits: if self.queueSize<1
canAttackUnderwaterUnits: false
isFixedFiring: true
#turretSize: 10
aimOffsetSpread: 0
maxAttackRange: 240
shootDelay: 1.6s
showRangeUIGuide:false

[turret_T1T2]
canAttackCondition: if (self.resource(type='ZergRangeAttack',equalTo=0) or self.resource(type='ZergRangeAttack',equalTo=1)) and numberOfUnitsInNeutralTeam(withTag='disruptionWeb',withinRange=120,lessThan=1) and self.queueSize(lessThan=1)
x: 0
y: 0
recoilOffset: 0
showRangeUIGuide:false
shoot_sound:attack.ogg
shoot_sound_vol:0.3
barrelY: 25
projectile:T1
altProjectile: T2
altProjectileCondition: if self.resource(type='ZergRangeAttack',equalTo=1)

[turret_T3T4]
canAttackCondition: if (self.resource(type='ZergRangeAttack',equalTo=2) or self.resource(type='ZergRangeAttack',equalTo=3)) and numberOfUnitsInNeutralTeam(withTag='disruptionWeb',withinRange=120,lessThan=1) and self.queueSize(lessThan=1)
@copyFromSection:turret_T1T2
projectile:T3
altProjectile: T4
altProjectileCondition: if self.resource(type='ZergRangeAttack',equalTo=3)

[projectile_T1]
areaDamage: 245
areaRadius: 27
targetGround: true
targetGroundSpread: 999
disableLeadTargeting: true
explodeEffect:CUSTOM:spark
explodeEffectOnShield:CUSTOM:spark
explodeOnEndOfLife: true
life: 6
speed: 0
turnSpeed: 0
areaDamageNoFalloff: true
invisible: true
spawnProjectilesOnExplode: T1(recursionLimit=5, yOffsetRelative=40)
mutator1_ifUnitWithTags: stasis
mutator1_areaDamageMultiplier:0

[projectile_T2]
areaDamage: 260
spawnProjectilesOnExplode: T2(recursionLimit=5, yOffsetRelative=40)
@copyFromSection:projectile_T1

[projectile_T3]
areaDamage: 275
spawnProjectilesOnExplode: T3(recursionLimit=5, yOffsetRelative=40)
@copyFromSection:projectile_T1

[projectile_T4]
areaDamage: 290
spawnProjectilesOnExplode: T4(recursionLimit=5, yOffsetRelative=40)
@copyFromSection:projectile_T1

[movement]
movementType: BUILDING
moveSpeed: 0
moveAccelerationSpeed: 20
moveDecelerationSpeed: 20
maxTurnSpeed: 20
turnAcceleration: 20
reverseSpeedPercentage:0
joinsGroupFormations: false
ignoreMoveOrders:true

[ai]
buildPriority: 0.8
noneInBaseExtraPriority: 0.8
noneGlobalExtraPriority: 0.8
maxEachBase: 10

[animation_burrow]
body_0s: {frame:9}
body_05s: {frame:10}
body_0.1s: {frame:11}
body_0.15s: {frame:12} 
body_0.2s: {frame:13}
body_0.25s: {frame:14}
body_0.3s: {frame:14}

[hiddenAction_feedback_debuff]
@copyFrom_skipThisSection: true

[effect_feedback]
@copyFrom_skipThisSection: true

[decal_grn_circle]
@copyFromSection: template_customSelectCircle
onlyWhenSelectedByOwnPlayer:true
image:ROOT:/DATA/total/circle_smll_grn_2.png

[decal_red_circle]
@copyFromSection: template_customSelectCircle
onlyWhenSelectedByEnemyPlayer:true
image:ROOT:/DATA/total/circle_smll_red_2.png

[decal_yellow_circle]
@copyFromSection: template_customSelectCircle
onlyWhenSelectedByAllyNotOwnPlayer:true
image:ROOT:/DATA/total/circle_smll_yell_2.png

[decal_hp]
@copyFromSection: template_customBar
@define totalFrames:7
image:ROOT:/DATA/total/hp_8.png
frame_width:25
frame_height:5
frame:int((self.hp*100/self.maxHp)/(100/${totalFrames}))
yOffsetAbsolute:17