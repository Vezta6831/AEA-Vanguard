
[core]
copyFrom:ROOT:/DATA/Zerg/units/meleeUnits.template, ROOT:/DATA/Zerg/units/burrow.template, ROOT:/DATA/Zerg/zergUpgrades.template, ROOT:/DATA/total/debuffs.template, ROOT:/DATA/total/customUI.template
name: zdrone
tags: drone,builder,S,bio,hover,canConsume,unit, AiBuilder
showActionsWithMixedSelectionIfOtherUnitsHaveTag:builder
logIfCreditResourceUsed:true
canRepairBuildings:false
price:Gas=32
ignoreInUnitCapCalculation: true


maxHp: 400
mass: 500
displayText: Drone
displayDescription: -Worker for Zerg\n-Transforms itself into buildings\n-Harvests resources
buildSpeed: 15s
radius: 14
displayRadius: 16
softCollisionOnAll: 50
dieOnConstruct: true
nanoRange: 50
canReclaimResources: true
nanoRangeForReclaim:20
nanoRangeForReclaimIsMelee:true
transportSlotsNeeded: 1
soundOnMoveOrder:droneOrder1.ogg:0.3,droneOrder2.ogg:0.3,droneOrder3.ogg:0.3
soundOnNewSelection:droneOrder1.ogg:0.3,droneOrder2.ogg:0.3,droneOrder3.ogg:0.3

[hiddenAction_soundOnCreate]
autoTriggerOnEvent: created
requireConditional:if self.customTarget1!=nullUnit
playSoundToPlayer:spawn.ogg
addWaypoint_type:move
addWaypoint_target_fromReference: customTarget1.readUnitMemory(name="rally",type="unit")

[action_basicMutation]
pos:-1
price:0
buildSpeed:0
text_ru: Базовые
text: Basic
isVisible: if self.resource(type='select',equalTo=0)
isActive: if self.resource(type='select',equalTo=0)
resourceAmount: select
resourceAmount_setValue: 1
iconImage:ROOT:/DATA/Zerg/basicMutation.png
alwaysSinglePress:true

[action_advancedMutation]
pos:-1
price:0
buildSpeed:0
text_ru: Продвинутые
text: Advanced
isVisible: if self.resource(type='select',equalTo=0)
isActive: if self.resource(type='select',equalTo=0)
resourceAmount: select
resourceAmount_setValue: 2
iconImage:ROOT:/DATA/Zerg/advancedMutation.png
alwaysSinglePress:true

[action_cancel]
pos:-1
price:0
buildSpeed:0
text_ru: Отмена
text: Cancel
isVisible: if self.resource(type='select',greaterThan=0)
isActive: if self.resource(type='select',greaterThan=0)
resourceAmount: select
resourceAmount_setValue: 0
iconImage:ROOT:/DATA/total/cancel.png
alwaysSinglePress:true

[canBuild_1]
name: CocoonHatchery
isVisible: if self.resource(type='select',equalTo=1) or (self.isControlledByAI() and not self.globalTeamTags(includes='Campaign'))

[canBuild_2]
name: CocoonExtractor
isVisible: if self.resource(type='select',equalTo=1) or self.isControlledByAI()

[canBuild_3]
name:CocoonCreepColony
isVisible: if self.resource(type='select',equalTo=1) or (self.isControlledByAI() and not self.globalTeamTags(includes='Campaign'))

[canBuild_4]
name: CocoonEvolution
isVisible: if self.resource(type='select',equalTo=1) or (self.isControlledByAI() and not self.globalTeamTags(includes='Campaign'))

[canBuild_5]
name: CocoonSpawningPool
isVisible: if self.resource(type='select',equalTo=1) or (self.isControlledByAI() and not self.globalTeamTags(includes='Campaign'))

[canBuild_6]
name: CocoonHydraliskDen
isLocked: if not self.hasUnitInTeam(withTag='SpawningPool')
isLockedMessage_ru:Требуется:\n Омут рождения
isLockedMessage:Requires:\n Spawning pool
isVisible: if self.resource(type='select',equalTo=1) or (self.isControlledByAI() and not self.globalTeamTags(includes='Campaign'))

[canBuild_7]
name: CocoonSpire
isLocked: if not self.hasUnitInTeam(withTag='Lair')
isLockedMessage_ru:Требуется:\n Логово
isLockedMessage:Requires:\n Lair
isVisible: if self.resource(type='select',equalTo=2) and not self.globalTeamTags(includes='SpireLocked') or (self.isControlledByAI() and not self.globalTeamTags(includes='Campaign'))

[canBuild_8]
name: CocoonQueenNest
isLocked: if not self.hasUnitInTeam(withTag='Lair')
isLockedMessage_ru:Требуется:\n Логово
isLockedMessage:Requires:\n Lair
isVisible: if self.resource(type='select',equalTo=2) and not self.globalTeamTags(includes='QueenNestLocked') or (self.isControlledByAI() and not self.globalTeamTags(includes='Campaign'))

[canBuild_9]
name: CocoonUltraliskCavern
isLocked: if not self.hasUnitInTeam(withTag='Hive')
isLockedMessage_ru:Требуется:\n Улей
isLockedMessage:Requires:\n Hive
isVisible: if self.resource(type='select',equalTo=2) and not self.globalTeamTags(includes='UltraliskCavernLocked') or (self.isControlledByAI() and not self.globalTeamTags(includes='Campaign'))

[canBuild_10]
name: CocoonNidus
isLocked: if not self.hasUnitInTeam(withTag='Hive')
isLockedMessage_ru:Требуется:\n Улей
isLockedMessage:Requires:\n Hive
isLockedAlt: if self.hasUnitInTeam(withTag='NidusBuilding')
isLockedAltMessage_ru:Нельзя иметь больше 1 канала Нидуса
isLockedAltMessage:You can not have more than one Nidus channel
isVisible: if self.resource(type='select',equalTo=2) and not self.globalTeamTags(includes='NidusLocked') or (self.isControlledByAI() and not self.globalTeamTags(includes='Campaign'))

[canBuild_11]
name: CocoonDefilerMound
isLocked: if not self.hasUnitInTeam(withTag='Hive')
isLockedMessage_ru:Требуется:\n Улей
isLockedMessage:Requires:\n Hive
isVisible: if self.resource(type='select',equalTo=2) and not self.globalTeamTags(includes='DefilerMoundLocked') or (self.isControlledByAI() and not self.globalTeamTags(includes='Campaign'))

[effect_reclaim]
showInFog:false
attachedToUnit: false
life: 100
alpha: 0
priority: high
drawUnderUnits:false
alsoPlaySound:reclaim.ogg:25

[hiddenAction_moveToHarvest]
autoTrigger: if not self.hasActiveWaypoint(type="reclaim") and not self.hasActiveWaypoint(type="touchTarget") and not self.hasActiveWaypoint(type="build") and self.isControlledByAI() and self.globalTeamTags(includes='Campaign')
addWaypoint_type: reclaim
addWaypoint_target_nearestUnit_tagged: resources
addWaypoint_target_nearestUnit_team: neutral
clearAllWaypoints:true

[hiddenAction_moveToUnload]
autoTrigger: if self.hasActiveWaypoint(type='reclaim') and self.hasResources(localMinerals=8)
addWaypoint_type: touchTarget
addWaypoint_prepend: true
addWaypoint_target_nearestUnit_tagged: resourceDropoff
addWaypoint_target_nearestUnit_team: own
addWaypoint_triggerActionIfFailed: findFailed
convertTo:drone2

[hiddenAction_moveToUnload_2]
autoTrigger: if self.hasActiveWaypoint(type='reclaim') and self.hasResources(localGas=8)
addWaypoint_type: touchTarget
addWaypoint_prepend: true
addWaypoint_target_nearestUnit_tagged: resourceDropoff
addWaypoint_target_nearestUnit_team: own
addWaypoint_triggerActionIfFailed: findFailed
convertTo:drone3

[hiddenAction_moveToUnload_3]
autoTrigger: if self.hasActiveWaypoint(type='reclaim') and self.hasResources(localGas2=8)
addWaypoint_type: touchTarget
addWaypoint_prepend: true
addWaypoint_target_nearestUnit_tagged: resourceDropoff
addWaypoint_target_nearestUnit_team: own
addWaypoint_triggerActionIfFailed: findFailed
convertTo:drone3

[hiddenAction_findFailed]
clearActiveWaypoint: true

[hiddenAction_unload]
autoTriggerOnEvent: touchTargetSuccess
alsoTriggerAction: unloadMinerals, unloadGas, unloadGas2

[hiddenAction_unloadMinerals]
requireConditional:if self.hasResources(localMinerals=8)
addResources: localMinerals=-8
addResourcesScaledByAIHandicaps:Minerals=8
convertTo:zdrone

[hiddenAction_unloadGas]
requireConditional:if self.hasResources(localGas=8)
addResources: localGas=-8
addResourcesScaledByAIHandicaps:Gas=8
convertTo:zdrone
alsoTriggerAction: aiBoost

[hiddenAction_unloadGas2]
requireConditional:if self.hasResources(localGas2=8)
addResources: localGas2=-8
addResourcesScaledByAIHandicaps:Gas=2
convertTo:zdrone
alsoTriggerAction: aiBoost

[hiddenAction_aiBoost]
requireConditional: if self.isControlledByAI()
addResourcesScaledByAIHandicaps: Gas=4

[hiddenAction_burrow_2]
convertTo: DroneUnderGround
buildSpeed: 0.25s
whenBuilding_rotateTo:45
whenBuilding_temporarilyConvertTo: DroneUnderGround2

[hiddenAction_addChrysalis]
autoTrigger: if self.resource(type="chrysalis")>=1
convertTo:drone4

[hiddenAction_addKhaydarin]
autoTrigger: if self.resource(type="khaydarin")>=1
convertTo:drone5

[effect_corpse]
alwayStartDirAtZero:true
attachedToUnit: false
life: 80
alpha: 8
image: death.png
priority: critical
drawUnderUnits: true
total_frames:8
animateFrameStart:0
animateFrameEnd:7
animateFrameSpeed:0.2
alsoPlaySound:death.ogg

[effect_sparks]
alwayStartDirAtZero:true
attachedToUnit: false
life: 80
alpha: 8
image: spark.png
priority: critical
drawUnderUnits:false
total_frames:8
animateFrameStart:0
animateFrameEnd:7
animateFrameSpeed:0.2

[effect_acid]
attachedToUnit: false
yOffsetRelative: 30
life: 70
alpha: 7
image:acid.png
priority: critical
drawUnderUnits:false
total_frames:7
animateFrameStart:0
animateFrameEnd:6
animateFrameSpeed:0.2

[graphics]
image_offsetY:-5
icon_build: drone_icon.png
image:        drone.png
image_wreak:  dead.png
image_shadow: AUTO_ANIMATED
shadowOffsetX:0
shadowOffsetY:3
drawLayer:experimentals
animation_moving_start: 0
animation_moving_end: 4
animation_moving_speed: 3
reclaimEffect:NONE
lock_body_rotation_with_main_turret: true
rotate_with_direction: false
animation_direction_units: 45
animation_direction_strideX:0
animation_direction_strideY:1
animation_direction_starting:180
frame_width:  50
frame_height: 50

[attack]
aimOffsetSpread:0
canAttack: true
canAttackFlyingUnits: false
canAttackLandUnits: true
canAttackUnderwaterUnits: false
isFixedFiring: true
disablePassiveTargeting:true
turretSize: 10
maxAttackRange: 15
shootDelay: 0.924s
meleeEngangementDistance: 120
isMelee:true
showRangeUIGuide:false

[turret_1]
canAttackCondition: if numberOfUnitsInNeutralTeam(withTag='disruptionWeb',withinRange=120)<=0
x: 0
y: 0
shoot_sound:vomit.ogg
shoot_sound_vol:0.3
recoilOffset: 0
shoot_flame:CUSTOM:acid
showRangeUIGuide:false
onShoot_freezeBodyMovementFor:0.63s

[turret_nano]
x: 0
y: 0
size:22
isMainNanoTurret:true
canShoot:false
showRangeUIGuide:false

[projectile_1]
directDamage: 15
life: 10
instant:true
invisible: true
explodeEffect:CUSTOM:sparks
explodeEffectOnShield:CUSTOM:sparks

[movement]
moveSpeed: 1.488
moveAccelerationSpeed: 0.04
moveDecelerationSpeed: 0.04

[ai]
useAsBuilder: true
useAsHarvester: true
whenUsingAsHarvester_recommendedInEachBase: 16
onlyUseAsHarvester_ifBaseHasUnitTagged: resourceDropoff
maxEachBase: 16

[animation_harvest]
onActions : reclaim
body_0s: {frame:5}
body_0.1s: {frame:6}
body_0.2s: {frame:7} 
body_0.3s: {frame:8}
body_0.4s: {frame:9}
body_0.5s: {frame:10}
body_0.69s: {frame:10}
body_0.7s: {frame:5}
body_0.8s: {frame:6}
body_0.9s: {frame:7} 
body_1s: {frame:8}
body_1.1s: {frame:9}
body_1.2s: {frame:10}
body_1.4s: {frame:10}
effect_0s: {name:NONE}
effect_0.1s: {name:CUSTOM|reclaim,x:0,y:0}

[animation_burrow]
body_0s: {frame:4}
body_0.05s: {frame:3}
body_0.1s: {frame:2} 
body_0.15s: {frame:1}
body_0.2s: {frame:0}
body_0.25s: {frame:0}

[resource_chrysalis]
hidden:true

[resource_khaydarin]
hidden:true

[hiddenAction_feedback_debuff]
@copyFrom_skipThisSection: true

[effect_feedback]
@copyFrom_skipThisSection: true

[decal_grn_circle]
@copyFromSection: template_customSelectCircle
onlyWhenSelectedByOwnPlayer:true
image:ROOT:/DATA/total/circle_smll_grn_2.png

[decal_red_circle]
@copyFromSection: template_customSelectCircle
onlyWhenSelectedByEnemyPlayer:true
image:ROOT:/DATA/total/circle_smll_red_2.png

[decal_yellow_circle]
@copyFromSection: template_customSelectCircle
onlyWhenSelectedByAllyNotOwnPlayer:true
image:ROOT:/DATA/total/circle_smll_yell_2.png

[decal_hp]
@copyFromSection: template_customBar
@define totalFrames:7
image:ROOT:/DATA/total/hp_8.png
frame_width:25
frame_height:5
frame:int((self.hp*100/self.maxHp)/(100/${totalFrames}))
yOffsetAbsolute:17