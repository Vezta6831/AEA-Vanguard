[core]
copyFrom:ROOT:/DATA/Zerg/units/meleeUnits.template,ROOT:/DATA/Zerg/units/burrow.template, ROOT:/DATA/Zerg/zergUpgrades.template, ROOT:/DATA/total/debuffs.template, ROOT:/DATA/total/customUI.template
name: defiler
tags:M,bio,haveEnergy,canConsume,unit
price:Minerals=650,Gas=275
maxHp: 1250
armour:1
mass: 500
energyMax:200
energyRegen:0.01
energyStartingPercentage:0.25
displayText_ru: Осквернитель
displayText: Defiler
displayDescription: -Support Specialist\n-Has No Attack\n-Can Consume friendly zerg for energy(All units give 50)\n-Can cast dark swarm. Direct range attacks to no damage to units under dark swarm. Splash damage is still applied\n-Can cast Plague. Afflicted targets take 12 DPS until 295 hitpoints are lost. Reduces HP to 1, but does not kill.
buildSpeed: 32s
radius: 18
displayRadius: 20
transportSlotsNeeded: 2
soundOnMoveOrder: defiler_order.ogg:0.3,defiler_order2.ogg:0.3,defiler_order3.ogg:0.3,defiler_order4.ogg:0.3
soundOnNewSelection:defiler_order.ogg:0.3,defiler_order2.ogg:0.3,defiler_order3.ogg:0.3,defiler_order4.ogg:0.3

[hiddenAction_soundOnCreate]
autoTriggerOnEvent: created
requireConditional:if self.customTarget1!=nullUnit
playSoundToPlayer:spawn.wav
addWaypoint_type:move
addWaypoint_target_fromReference: customTarget1.readUnitMemory(name="rally",type="unit")

[hiddenAction_maxEnergy]
autoTrigger: if self.globalTeamTags(includes='MetasynapticNode') and not self.tags(includes='maxEnergy')
temporarilyAddTags: maxEnergy
setUnitStats: maxEnergy=250

[action_burrow]
setBodyRotation: 45

[hiddenAction_burrow_2]
convertTo: DefilerUnderGround
buildSpeed: 0.25s
whenBuilding_rotateTo:45
whenBuilding_temporarilyConvertTo: DefilerUnderGround2
whenBuilding_temporarilyConvertTo_keepFields: maxEnergy
convertTo_keepCurrentFields: maxEnergy

[effect_plague]
alwayStartDirAtZero:true
attachedToUnit: false
life: 140
alpha: 14
image:plague.png
priority: critical
drawUnderUnits:false
total_frames:14
animateFrameStart:0
animateFrameEnd:13
animateFrameSpeed:0.2
frame_width:  130
frame_height: 130

[action_consume]
isVisible: if self.globalTeamTags(includes='DefilerNestConsume')
isActive: if self.globalTeamTags(includes='DefilerNestConsume') and not self.energy(full=true) and self.resource.maelstrom<=0 and self.resource.stasis<=0
text_ru: Поглощение
text: Consume
buildSpeed: 0s
highPriorityQueue: false
fireTurretXAtGround: null
fireTurretXAtGround_withProjectile:null
onlyOneUnitAtATime: true
ai_isDisabled:true
iconImage:ROOT:/DATA/Zerg/consumeIcon.png
alsoTriggerAction:consume_2
alsoTriggerOrQueueActionConditional: if thisActionTarget.nearestUnit(withinRange=50, withTag='canConsume', relation='any')!=self and thisActionTarget.nearestUnit(withinRange=50, withTag='canConsume', relation='any').teamId == self.teamId and thisActionTarget.nearestUnit(withinRange=50, withTag='canConsume', relation='any') != nullUnit

[hiddenAction_consume_2]
addWaypoint_type: touchTarget
clearAllWaypoints:true
addWaypoint_target_fromReference: thisActionTarget.nearestUnit(withinRange=50, withTag='canConsume', relation='any') 
addWaypoint_target_nearestUnit_team: own

[hiddenAction_consume_3]
autoTriggerOnEvent: touchTargetSuccess
sendMessageTo: eventSource
sendMessageWithTags:consume
playSoundAtUnit:consume.ogg:0.4

[action_plague]
price:energy=200
isVisible: if self.globalTeamTags(includes='DefilerNestPlague')
isActive: if self.resource.maelstrom<=0 and self.resource.stasis<=0
buildSpeed:0s
text_ru:Чума
text: Plague
fireTurretXAtGround: null_1
fireTurretXAtGround_withProjectile:plague
onlyOneUnitAtATime: true
ai_isDisabled: true
iconImage:ROOT:/DATA/Zerg/plague.png
playSoundAtUnit:plague.ogg:0.4

[action_plague_ai]
price:energy=200
isVisible: if self.globalTeamTags(includes='DefilerNestPlague') and self.isControlledByAI()
isActive: if self.globalTeamTags(includes='DefilerNestPlague') and nearestUnit(withinRange=310, withTag='unit', relation='enemy') != nullUnit and self.resource.maelstrom<=0 and self.resource.stasis<=0
buildSpeed:0s
text_ru:Чума
text: Plague
onlyOneUnitAtATime: true
fireTurretXAtGround: null_1
fireTurretXAtGround_withProjectile:plague
fireTurretXAtGround_withTarget: nearestUnit(withinRange=320, withTag='unit', relation='enemy')
playSoundAtUnit:plague.ogg:0.4
ai_isHighPriority: true
iconImage:ROOT:/DATA/Zerg/plague.png

[action_darkSwarm]
price:energy=100
isVisible:true
isActive: if self.resource.maelstrom<=0 and self.resource.stasis<=0
buildSpeed:0s
text_ru:Тёмный Рой
text:Dark Swarm
fireTurretXAtGround: null_1
fireTurretXAtGround_withProjectile:swarm
onlyOneUnitAtATime: true
ai_isDisabled: true
iconImage:darkSwarmIcon.png

[effect_corpse]
alwayStartDirAtZero:true
attachedToUnit: false
life: 50
alpha: 5
image: death.png
priority: critical
drawUnderUnits: true
total_frames:5
animateFrameStart:0
animateFrameEnd:4
animateFrameSpeed:0.2
alsoPlaySound:death.wav

[graphics]
total_frames: 8
icon_build: defiler_icon.png
image:        defiler.png
image_wreak:  dead.png
image_shadow:ROOT:/DATA/total/shadow_2.png
shadowOffsetX:0
shadowOffsetY:2
animation_moving_start: 0
animation_moving_end: 7
animation_moving_speed: 3
animation_idle_start: 0
animation_idle_end: 7
animation_idle_speed: 4
lock_body_rotation_with_main_turret: true
drawLayer:experimentals
rotate_with_direction: false
animation_direction_units: 45
animation_direction_strideX:0
animation_direction_strideY:1
animation_direction_starting:180
frame_width:  80
frame_height: 80

[attack]
maxAttackRange: 0
shootDelay:10s
isMelee: false
meleeEngangementDistance: IGNORE
canAttackLandUnits: false

[turret_null]
x: 0
y: 0
limitingRange:9999
canAttackCondition: if self.globalTeamTags(includes='GOVNO')
showRangeUIGuide:false

[turret_null_1]
x: 0
y: 0
limitingRange:320
canAttackCondition: if self.globalTeamTags(includes='GOVNO')
showRangeUIGuide:false

[projectile_null]
life:0
speed:0
directDamage: 0
targetGround: true
explodeEffect:NONE

[projectile_plague]
directDamage: 0
areaDamage:0
areaRadius:80
areaDamageNoFalloff: true
areaHitAirAndLandAtSameTime: true
friendlyFire: true
targetGround: true
life: 10
instant:true
invisible:true
explodeEffect:CUSTOM:plague
mutator1_ifUnitWithTags:S,M,L,building
mutator1_areaDamageMultiplier: 0
mutator1_addResourcesAreaHit: plague=25

[projectile_swarm]
life: 20
instant: true
invisible: true
directDamage: 0
targetGround: true
explodeOnEndOfLife: true
spawnUnit:darkSwarm
explodeEffect:NONE

[movement]
moveSpeed: 1.1904

[ai]
maxGlobal: 2

[animation_burrow]
body_0s: {frame:4}
body_0.05s: {frame:3}
body_0.1s: {frame:2}
body_0.15s: {frame:1}
body_0.2s: {frame:0}
body_0.25s: {frame:0}

[decal_ensnare_goo]
image:ROOT:/DATA/total/ensnare_goo_2.png

[decal_plague_goo]
image:ROOT:/DATA/total/plague_goo_2.png

[decal_defensive_matrix]
image:ROOT:/DATA/total/defensive_matrix_2.png

[effect_mindControl]
image:ROOT:/DATA/total/mindControl_2.png
frame_width: 64
frame_height: 64

[effect_feedback]
image:ROOT:/DATA/total/feedback_2.png
frame_width: 128
frame_height: 128

[decal_maelstrom]
image:ROOT:/DATA/total/maelstrom_2.png
frame_width:  64
frame_height: 64

[decal_grn_circle]
@copyFromSection: template_customSelectCircle
onlyWhenSelectedByOwnPlayer:true
image:ROOT:/DATA/total/circle_med_grn.png

[decal_red_circle]
@copyFromSection: template_customSelectCircle
onlyWhenSelectedByEnemyPlayer:true
image:ROOT:/DATA/total/circle_med_red.png

[decal_yellow_circle]
@copyFromSection: template_customSelectCircle
onlyWhenSelectedByAllyNotOwnPlayer:true
image:ROOT:/DATA/total/circle_med_yell.png

[decal_hp]
@copyFromSection: template_customBar
@define totalFrames:10
image:ROOT:/DATA/total/hp_11.png
frame_width:34
frame_height:5
frame:int((self.hp*100/self.maxHp)/(100/${totalFrames}))
yOffsetAbsolute:23

[decal_energy]
@copyFromSection: template_customBar
@define totalFrames:11
onlyWhenSelectedByOwnPlayer:true
onlyWhenSelectedByAnyPlayer:false
image:ROOT:/DATA/total/energy_11.png
frame_width:34
frame_height:5
frame:int((self.energy*100/self.maxEnergy)/(100/${totalFrames}))
yOffsetAbsolute:29