[core]
copyFrom:ROOT:/DATA/Zerg/units/undergroundUnits.template, ROOT:/DATA/Zerg/zergUpgrades.template, ROOT:/DATA/total/debuffs.template,ROOT:/DATA/total/customUI.template
name: DefilerUnderGround2
tags:M,bio,undergroundZerg,haveEnergy,unit,canConsume
maxHp: 80
energyMax:200
energyRegen: 0.01
borrowResourcesWhileAlive:supply=2, displaySupply=-2
armour:1
displayText_ru: Осквернитель
displayText: Defiler
displayRadius: 10
soundOnMoveOrder: defiler_order.ogg:0.3,defiler_order2.ogg:0.3,defiler_order3.ogg:0.3,defiler_order4.ogg:0.3
soundOnNewSelection:defiler_order.ogg:0.3,defiler_order2.ogg:0.3,defiler_order3.ogg:0.3,defiler_order4.ogg:0.3

[hiddenAction_maxEnergy]
autoTrigger: if self.globalTeamTags(includes='MetasynapticNode') and not self.tags(includes='maxEnergy')
temporarilyAddTags: maxEnergy
setUnitStats: maxEnergy=250

[action_burrow]
setBodyRotation: 45

[hiddenAction_burrow_2]
convertTo: defiler
buildSpeed: 0.25s
whenBuilding_rotateTo:45
convertTo_keepCurrentFields: maxEnergy

[hiddenAction_detect]
autoTrigger: if numberOfUnitsInEnemyTeam(withTag='detector',withinRange=320)<1 and numberOfUnitsInEnemyTeam(withTag='detectorRange',withinRange=440)<1 and self.queueSize<=0 and self.resource.d_matrix<=0 and self.resource.maelstrom<=0 and self.resource.stasis<=0 and self.resource.ensnare<=0 and self.resource.plague<=0
convertTo: DefilerUnderGround
convertTo_keepCurrentFields: maxEnergy

[effect_corpse]
alwayStartDirAtZero:true
attachedToUnit: false
life: 50
alpha: 5
image: death.png
priority: critical
drawUnderUnits: true
total_frames:5
animateFrameStart:0
animateFrameEnd:4
animateFrameSpeed:0.2
alsoPlaySound:death.wav

[graphics]
total_frames: 5
icon_build: defiler_icon.png
image: burrow.png
image_wreak:  dead.png
animation_moving_start: 0
animation_moving_end: 0
animation_moving_speed: 120
animation_idle_start: 0
animation_idle_end: 0
animation_idle_speed: 120
animation_attack_start: 0
animation_attack_end: 0
animation_attack_speed: 6
showEnergyBar: true
lock_body_rotation_with_main_turret: true
drawLayer:experimentals
rotate_with_direction: false

[ai]
upgradedFrom: DefilerUnderGround

[animation_burrow]
body_0s: {frame:0}
body_0.05s: {frame:1}
body_0.1s: {frame:2}
body_0.15s: {frame:3}
body_0.2s: {frame:4}
body_0.25s: {frame:4}

[decal_grn_circle]
@copyFromSection: template_customSelectCircle
onlyWhenSelectedByOwnPlayer:true
image:ROOT:/DATA/total/circle_smll_grn.png

[decal_red_circle]
@copyFromSection: template_customSelectCircle
onlyWhenSelectedByEnemyPlayer:true
image:ROOT:/DATA/total/circle_smll_red.png

[decal_yellow_circle]
@copyFromSection: template_customSelectCircle
onlyWhenSelectedByAllyNotOwnPlayer:true
image:ROOT:/DATA/total/circle_smll_yell.png

[decal_hp]
@copyFromSection: template_customBar
@define totalFrames:5
image:ROOT:/DATA/total/hp_6.png
frame_width:19
frame_height:5
frame:int((self.hp*100/self.maxHp)/(100/${totalFrames}))
yOffsetAbsolute:14

[decal_energy]
@copyFromSection: template_customBar
@define totalFrames:6
onlyWhenSelectedByOwnPlayer:true
onlyWhenSelectedByAnyPlayer:false
image:ROOT:/DATA/total/energy_6.png
frame_width:19
frame_height:5
frame:int((self.energy*100/self.maxEnergy)/(100/${totalFrames}))
yOffsetAbsolute:19