[core]
copyFrom:ROOT:/DATA/total/forcesAttack.template, ROOT:/DATA/Terran/terranUpgrades.template, ROOT:/DATA/total/debuffs.template, ROOT:/DATA/total/customUI.template
name: medic
tags: medic,bio,S,unit
isBuilder:true
canRepairBuildings:false
canRepairUnits:true
class: CustomUnitMetadata
price:Gas=75
maxHp: 300
armour:1
energyMax:200
energyRegen:0.016666666
energyStartingPercentage:0.25
mass: 500
displayText_ru: Медик
displayText: Medic
displayDescription: -Heals friendly biological units\n-No attack\n-Can temporarily blind targets\n-Can remove debuffs\n-Woman fighting alongside released convicts
techLevel: 1
buildSpeed: 11s
#availableInDemo: true
radius: 12
hideScorchMark: false
displayRadius: 14
isBio: true
isBug: false
isUnrepairableUnit: false
softCollisionOnAll: 5
transportSlotsNeeded: 1
nanoRange:70
nanoRangeForRepair: 70
nanoRangeForRepairIsMelee: true
nanoRepairSpeed:0.28
fogOfWarSightRange:17
autoRepair:true
canRepairUnitsOnlyWithTags: bio
effectOnDeath:CUSTOM:corpse
soundOnMoveOrder:medic_order.ogg:0.3,medic_order2.ogg:0.3,medic_order3.ogg:0.3,medic_order4.ogg:0.3
soundOnAttackOrder:medic_order.ogg:0.3,medic_order2.ogg:0.3,medic_order3.ogg:0.3,medic_order4.ogg:0.3
soundOnNewSelection:medic_order.ogg:0.3,medic_order2.ogg:0.3,medic_order3.ogg:0.3,medic_order4.ogg:0.3

[hiddenAction_autoRepair]
requireConditional: if select(self.hp(full=true),numberOfUnitsInTeam(withTag='repairInfantry',withinRange=200)>0,numberOfUnitsInTeam(withTag='repairInfantry',withinRange=200)>1) or self.numberOfUnitsInAllyNotOwnTeam(withTag='repairInfantry',withinRange=200)>0
autoTrigger: if self.hasActiveWaypoint(type='attackmove') or not self.hasActiveWaypoint() or self.hasActiveWaypoint(type='attack')
addWaypoint_target_randomUnit_tagged: repairInfantry
addWaypoint_target_randomUnit_team: ally
addWaypoint_target_randomUnit_maxRange: 200
addWaypoint_type:repair
addWaypoint_prepend: true
addWaypoint_triggerActionIfFailed: autoRepair

[hiddenAction_repairForMedic]
autoTrigger: if not self.hp(full=true) and not self.tags(includes='repairInfantry')
temporarilyAddTags:repairInfantry

[hiddenAction_notRepairForMedic]
autoTrigger: if self.hp(full=true) and self.tags(includes='repairInfantry')
temporarilyRemoveTags:repairInfantry

[hiddenAction_guardForAI]
autoTrigger: if self.isControlledByAI() and not self.hasActiveWaypoint(type='repair') and numberOfUnitsInTeam(withTag='infantry',withinRange=200,lessThan=1)
addWaypoint_type: touchTarget
clearAllWaypoints:true
addWaypoint_target_nearestUnit_team:own
addWaypoint_target_nearestUnit_tagged:infantry

[hiddenAction_soundOnCreate]
autoTriggerOnEvent: created
playSoundToPlayer:spawn.wav
requireConditional:if self.customTarget1!=nullUnit
addWaypoint_type:move
addWaypoint_target_fromReference: customTarget1.readUnitMemory(name="rally",type="unit")

[action_restoration]
isActive: if self.resource.maelstrom<=0 and self.resource.stasis<=0
price:energy=50
buildSpeed:0s
text_ru:Восстановление
text:Restoration
onlyOneUnitAtATime: true
fireTurretXAtGround:null
fireTurretXAtGround_withProjectile:null
ai_isDisabled: true
iconImage:ROOT:/DATA/Protoss/feedbackIcon.png
addResources:energy=50
alsoTriggerAction:restoration_2
alsoTriggerOrQueueActionConditional: if thisActionTarget.nearestUnit(withinRange=50, withTag='unit', relation='any') != nullUnit and thisActionTarget.nearestUnit(withinRange=50, withTag='unit', relation='any').teamId == self.teamId and thisActionTarget.nearestUnit(withinRange=50, withTag='unit', relation='any') != self and (thisActionTarget.nearestUnit(withinRange=50, withTag='unit', relation='any').resource.ensnare>0 or thisActionTarget.nearestUnit(withinRange=50, withTag='unit', relation='any').resource.plague>0 or thisActionTarget.nearestUnit(withinRange=50, withTag='unit', relation='any').resource.lockdown>0)

[hiddenAction_restoration_2]
addResources:energy=-50
#playSoundAtUnit:feedback.ogg:0.4
sendMessageTo: thisActionTarget.nearestUnit(withinRange=50)
sendMessageWithTags:Restoration

[hiddenAction_armor]
autoTrigger: if self.resource(type='TerranInfantryArmor',greaterThan=0) and not self.tags(includes='armor1')
temporarilyAddTags: armor1
setUnitStats: armour+=1

[hiddenAction_armor_2]
autoTrigger: if self.resource(type='TerranInfantryArmor',greaterThan=1) and not self.tags(includes='armor2')
temporarilyAddTags: armor2
setUnitStats: armour+=1

[hiddenAction_armor_3]
autoTrigger: if self.resource(type='TerranInfantryArmor',greaterThan=2) and not self.tags(includes='armor3')
temporarilyAddTags: armor3
setUnitStats: armour+=1

[effect_corpse]
alwayStartDirAtZero:true
attachedToUnit: false
life: 50
alpha: 5
image: death.png
priority: critical
drawUnderUnits: true
total_frames:5
animateFrameStart:0
animateFrameEnd:4
animateFrameSpeed:0.2
alsoPlaySound:death.ogg

[graphics]
image_offsetY:-10
total_frames: 10
icon_build: medic_icon.png
image:        medic.png
image_wreak:  dead.png
image_turret: NONE
image_shadow:ROOT:/DATA/total/shadow.png
animation_moving_start: 0
animation_moving_end: 7
animation_moving_speed: 3
repairEffect: NONE
lock_body_rotation_with_main_turret: true
drawLayer:experimentals
rotate_with_direction: false
animation_direction_units: 45
animation_direction_strideX:0
animation_direction_strideY:1
animation_direction_starting:180
frame_width:  64
frame_height: 64

[attack]
aimOffsetSpread:0
canAttack: true
canAttackFlyingUnits: false
canAttackLandUnits:   false
canAttackUnderwaterUnits: false
isMelee:true
isFixedFiring: true
turretSize: 8
turretTurnSpeed: 3
showRangeUIGuide:false
maxAttackRange:70

[turret_1]
x: 0
y: 0
isMainNanoTurret:true
canShoot:false
canAttackFlyingUnits: false
canAttackLandUnits:   false
canAttackUnderwaterUnits: false
recoilOffset: 0
shoot_flame:NONE
energyUsage:1
showRangeUIGuide:false
onShoot_freezeBodyMovementFor:0.63s

[turret_null]
x: 0
y: 0
limitingRange:320
canShoot: false
projectile:null
showRangeUIGuide:false

[projectile_null]
life:0
speed:0
invisible: true
directDamage: 0
explodeEffect:NONE
explodeEffectOnShield:NONE

[movement]
movementType: LAND
moveSpeed: 1.2504
moveAccelerationSpeed: 20
moveDecelerationSpeed: 20
maxTurnSpeed: 20
turnAcceleration: 20
moveSlidingMode: false
moveIgnoringBody:true
reverseSpeedPercentage:0
joinsGroupFormations: false

[ai]
buildPriority: 0.8
noneInBaseExtraPriority: 0.8
noneGlobalExtraPriority: 0.8
maxEachBase: 10

[animation_repair]
onActions : repair
body_0s: {frame:8}
body_0.03s: {frame:9}
body_0.06s: {frame:9}

[hiddenAction_debuff_lockdown]
@copyFrom_skipThisSection: true

[hiddenAction_removeDebuff_lockdown]
@copyFrom_skipThisSection: true

[decal_grn_circle]
@copyFromSection: template_customSelectCircle
onlyWhenSelectedByOwnPlayer:true
image:ROOT:/DATA/total/circle_smll_grn.png

[decal_red_circle]
@copyFromSection: template_customSelectCircle
onlyWhenSelectedByEnemyPlayer:true
image:ROOT:/DATA/total/circle_smll_red.png

[decal_yellow_circle]
@copyFromSection: template_customSelectCircle
onlyWhenSelectedByAllyNotOwnPlayer:true
image:ROOT:/DATA/total/circle_smll_yell.png

[decal_hp]
@copyFromSection: template_customBar
@define totalFrames:5
image:ROOT:/DATA/total/hp_6.png
frame_width:19
frame_height:5
frame:int((self.hp*100/self.maxHp)/(100/${totalFrames}))
yOffsetAbsolute:14