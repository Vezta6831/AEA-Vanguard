[core]
copyFrom:ROOT:/DATA/total/forcesAttack.template, ROOT:/DATA/total/debuffs.template, ROOT:/DATA/total/customUI.template
name: scv
tags: scv, builder,AiBuilder, S, unit, bio, hover, mech
showActionsWithMixedSelectionIfOtherUnitsHaveTag:builder
logIfCreditResourceUsed:true
canRepairBuildings:true
canRepairUnits:true
class: CustomUnitMetadata
price:Gas=55
maxHp: 500
mass: 500
displayText_ru: КСМ
displayText: SCV
displayDescription: -Is claustrophobic\n-Harvests resources and constructs buildings\n-Can repair mechanical units at the cost of resources
techLevel: 1
buildSpeed: 15s
#availableInDemo: true
radius: 12
displayRadius: 14
isBio: true
hideScorchMark: false
isBug: false
isBuilder: true
isUnrepairableUnit: false
softCollisionOnAll: 50
fogOfWarSightRange:17
nanoRange: 50
canRepairUnitsOnlyWithTags: mech, scv
nanoRangeForRepair:90
nanoRepairSpeed:1
dieOnConstruct:true
canReclaimResources: true
nanoRangeForReclaim:20
nanoRangeForReclaimIsMelee:true
transportSlotsNeeded: 1
effectOnDeath:CUSTOM:corpse
soundOnMoveOrder:scv_order.ogg:0.3,scv_order2.ogg:0.3,scv_order3.ogg:0.3,scv_order4.ogg:0.3
soundOnNewSelection:scv_order.ogg:0.3,scv_order2.ogg:0.3,scv_order3.ogg:0.3,scv_order4.ogg:0.3
soundOnAttackOrder:scv_order.ogg:0.3,scv_order2.ogg:0.3,scv_order3.ogg:0.3,scv_order4.ogg:0.3
ignoreInUnitCapCalculation: true
[action_basicStructure]
pos:-1
price:0
buildSpeed:0
text_ru: Базовые
text: Basic
isVisible: if self.resource(type='select',equalTo=0)
isActive: if self.resource(type='select',equalTo=0)
resourceAmount: select
resourceAmount_setValue: 1
iconImage:ROOT:/DATA/Terran/basicStructure.png
alwaysSinglePress:true
extraLagHidingInUI: true

[action_advancesStructure]
pos:-1
price:0
buildSpeed:0
text_ru: Продвинутые
text: Advanced
isVisible: if self.resource(type='select',equalTo=0)
isActive: if self.resource(type='select',equalTo=0)
resourceAmount: select
resourceAmount_setValue: 2
iconImage:ROOT:/DATA/Terran/advancedStructure.png
alwaysSinglePress:true
extraLagHidingInUI: true

[action_cancel]
pos:-1
price:0
buildSpeed:0
text_ru: Отмена
text: Cancel
isVisible: if self.resource(type='select',greaterThan=0)
isActive: if self.resource(type='select',greaterThan=0)
resourceAmount: select
resourceAmount_setValue: 0
iconImage:ROOT:/DATA/total/cancel.png
alwaysSinglePress:true
extraLagHidingInUI: true

[canBuild_1]
name: buildCommandCenter
isVisible: if self.resource(type='select',equalTo=1) or (self.isControlledByAI() and not self.globalTeamTags(includes='Campaign'))

[canBuild_2]
name: buildRefinery
isVisible: if self.resource(type='select',equalTo=1) or self.isControlledByAI()

[canBuild_3]
name:SupplyBuild
isLocked: if self.resource(type='supply',greaterThan=6) and self.isControlledByAI()
isVisible: if self.resource(type='select',equalTo=1) or (self.isControlledByAI() and not self.globalTeamTags(includes='Campaign'))

[canBuild_4]
name:buildBarrack
isVisible: if self.resource(type='select',equalTo=1) and not self.globalTeamTags(includes='BarrackLocked') or (self.isControlledByAI() and not self.globalTeamTags(includes='Campaign'))

[canBuild_5]
name:buildEngineeringBay
isVisible: if self.resource(type='select',equalTo=1) and not self.globalTeamTags(includes='EngineeringBayLocked') or (self.isControlledByAI() and not self.globalTeamTags(includes='Campaign'))

[canBuild_6]
name:AcademyBuild
isVisible: if self.resource(type='select',equalTo=1) and not self.globalTeamTags(includes='AcademyLocked') or (self.isControlledByAI() and not self.globalTeamTags(includes='Campaign'))
isLocked: if not self.hasUnitInTeam(withTag='Barrack')
isLockedMessage_ru:Требуется:\n  >Казармы
isLockedMessage:Requires:\n  >Battack

[canBuild_7]
name:buildBunker
isLocked: if not self.hasUnitInTeam(withTag='Barrack')
isLockedMessage_ru:Требуется:\n  >Казармы
isLockedMessage:Requires:\n  >Barracks
isVisible: if self.resource(type='select',equalTo=1) and not self.globalTeamTags(includes='BarrackLocked') or (self.isControlledByAI() and not self.globalTeamTags(includes='Campaign'))

[canBuild_8]
name:buildTurret
isVisible: if self.resource(type='select',equalTo=1) and not self.globalTeamTags(includes='EngineeringBayLocked') or (self.isControlledByAI() and not self.globalTeamTags(includes='Campaign'))

[canBuild_9]
name:buildFactory
isVisible: if self.resource(type='select',equalTo=2)

[canBuild_10]
name:ArmoryBuild
isVisible: if self.resource(type='select',equalTo=2)


[canBuild_11]
name:buildStarPort
isVisible: if self.resource(type='select',equalTo=2)


[canBuild_12]
name:buildScienceFacility
isLocked: if not self.hasUnitInTeam(withTag='Armory')
isLockedMessage_ru:Требуется:\n  >Космопорт
isLockedMessage:Requires:\n  >Armory
isVisible: if self.resource(type='select',equalTo=2) and not self.globalTeamTags(includes='ScienceFacilityLocked') or (self.isControlledByAI() and not self.globalTeamTags(includes='Campaign'))


[effect_light]
alwayStartDirAtZero:true
attachedToUnit: false
showInFog:false
life: 100
alpha: 10
yOffsetRelative:28
image: ROOT:/DATA/Terran/light.png
priority: critical
drawUnderUnits:false
total_frames:10
animateFrameStart:0
animateFrameEnd:9
animateFrameSpeed:0.2
scaleFrom:1
scaleTo: 1

[effect_bzzz]
alwayStartDirAtZero:true
attachedToUnit: false
showInFog:false
life: 10
image: ROOT:/DATA/total/null.png
priority: critical
alsoPlaySound:reclaim.ogg:0.2,reclaim2.ogg:0.2,reclaim3.ogg:0.2,reclaim4.ogg:0.2,reclaim5.ogg:0.2

[hiddenAction_soundOnCreate]
autoTriggerOnEvent: created
playSoundToPlayer:spawn.wav
requireConditional:if self.customTarget1!=nullUnit and not self.hasParent()
addWaypoint_type:move
addWaypoint_target_fromReference: customTarget1.readUnitMemory(name="rally",type="unit")

[hiddenAction_animation_build]
autoTrigger: if self.hasParent(withTag='build')
#playAnimation:harvest_3
playAnimationIfNotPlaying:harvest_3

[hiddenAction_move]
autoTrigger: if (self.hasParent(withTag='building') or self.hasParent(withTag='Refinery')) and not self.hasParent(withTag='build')
addWaypoint_type: move
addWaypoint_prepend: true
addWaypoint_position_relativeOffsetFromSelf: 0,-30
addWaypoint_maxTime: 2s
playSoundToPlayer:buildEnd.wav:0.3

[hiddenAction_moveToHarvest]
autoTrigger: if not self.hasActiveWaypoint(type="reclaim") and not self.hasActiveWaypoint(type="touchTarget") and not self.hasActiveWaypoint(type="repair") and not self.hasActiveWaypoint(type="build") and self.isControlledByAI() and self.globalTeamTags(includes='Campaign')
addWaypoint_type: reclaim
addWaypoint_target_nearestUnit_tagged: resources
addWaypoint_target_nearestUnit_team: neutral
clearAllWaypoints:true

[hiddenAction_moveToUnload]
autoTrigger: if self.hasActiveWaypoint(type='reclaim') and self.hasResources(localMinerals=8)
addWaypoint_type: touchTarget
addWaypoint_prepend: true
addWaypoint_target_nearestUnit_tagged: resourceDropoff
addWaypoint_target_nearestUnit_team: own
addWaypoint_triggerActionIfFailed: findFailed
convertTo:scv2

[hiddenAction_moveToUnload_2]
autoTrigger: if self.hasActiveWaypoint(type='reclaim') and self.hasResources(localGas=8)
addWaypoint_type: touchTarget
addWaypoint_prepend: true
addWaypoint_target_nearestUnit_tagged: resourceDropoff
addWaypoint_target_nearestUnit_team: own
addWaypoint_triggerActionIfFailed: findFailed
convertTo:scv3

[hiddenAction_moveToUnload_3]
autoTrigger: if self.hasActiveWaypoint(type='reclaim') and self.hasResources(localGas2=8)
addWaypoint_type: touchTarget
addWaypoint_prepend: true
addWaypoint_target_nearestUnit_tagged: resourceDropoff
addWaypoint_target_nearestUnit_team: own
addWaypoint_triggerActionIfFailed: findFailed
convertTo:scv3

[hiddenAction_findFailed]
clearActiveWaypoint: true

[hiddenAction_unload]
autoTriggerOnEvent: touchTargetSuccess
alsoTriggerAction: unloadMinerals, unloadGas, unloadGas2

[hiddenAction_unloadMinerals]
requireConditional:if self.hasResources(localMinerals=8)
addResources: localMinerals=-8
addResourcesScaledByAIHandicaps:Minerals=8
convertTo:scv

[hiddenAction_unloadGas]
requireConditional:if self.hasResources(localGas=8)
addResources: localGas=-8
addResourcesScaledByAIHandicaps:Gas=8
convertTo:scv
alsoTriggerAction: aiBoost

[hiddenAction_unloadGas2]
requireConditional:if self.hasResources(localGas2=8)
addResources: localGas2=-8
addResourcesScaledByAIHandicaps:Gas=2
convertTo:scv
alsoTriggerAction: aiBoost

[hiddenAction_aiBoost]
requireConditional: if self.isControlledByAI()
addResourcesScaledByAIHandicaps: Gas=4

[hiddenAction_addPsi-emitter]
autoTrigger: if self.resource(type="psi-emitter")>=1
convertTo:scv4

[effect_corpse]
alwayStartDirAtZero:true
attachedToUnit: false
life: 90
alpha: 9
image:ROOT:/DATA/Terran/units/death.png
priority: critical
drawUnderUnits: true
animateFrameStart:0
animateFrameEnd:8
animateFrameSpeed:0.2
alsoPlaySound:death.wav
frame_width:  128
frame_height: 128

[graphics]
image_offsetY:-13
total_frames: 5
icon_build: scv_icon.png
image:        scv.png
image_wreak:  NONE
image_turret: NONE
image_shadow: AUTO_ANIMATED
shadowOffsetX:0
shadowOffsetY:-2
animation_moving_start: 1
animation_moving_end: 2
animation_moving_speed: 2.5
reclaimEffect: NONE
repairEffect: NONE
lock_body_rotation_with_main_turret: true
drawLayer:experimentals
rotate_with_direction: false
animation_direction_units: 45
animation_direction_strideX:0
animation_direction_strideY:1
animation_direction_starting:180
frame_width:  70
frame_height: 70

[attack]
aimOffsetSpread:0
canAttack: true
canAttackFlyingUnits: false
canAttackLandUnits: true
canAttackUnderwaterUnits: false
meleeEngangementDistance: 120
isMelee:true
isFixedFiring: true
disablePassiveTargeting:true
turretSize: 10
maxAttackRange: 15
shootDelay: 0.63s

[turret_1]
canAttackCondition: if numberOfUnitsInNeutralTeam(withTag='disruptionWeb',withinRange=120)<=0
x: 0
y: 0
recoilOffset: 0
onShoot_freezeBodyMovementFor:0.62s

[turret_nano]
x: 0
y: 0
size:22
isMainNanoTurret:true
canShoot:false
showRangeUIGuide:false

[projectile_1]
directDamage: 15
life: 10
instant:true
invisible: true
explodeEffect:NONE

[movement]
movementType: LAND
moveSpeed: 1.488
moveAccelerationSpeed: 0.04
moveDecelerationSpeed: 0.04
maxTurnSpeed: 20
turnAcceleration: 20
reverseSpeedPercentage:0
joinsGroupFormations: false

[ai]
useAsBuilder:true
whenUsingAsHarvester_recommendedInEachBase: 16
onlyUseAsHarvester_ifBaseHasUnitTagged: resourceDropoff
buildPriority: 0.9
noneInBaseExtraPriority: 0.9
noneGlobalExtraPriority: 0.9
maxEachBase: 16

[animation_harvest]
onActions:reclaim
body_0s: {frame:3}
body_0.1s: {frame:4}
body_0.15s: {frame:4}
body_0.2s: {frame:3}
body_0.3s: {frame:4}
body_0.35s: {frame:4}
body_0.4s: {frame:3}
body_0.5s: {frame:4}
body_0.55s: {frame:4}
body_0.6s: {frame:3}
body_0.7s: {frame:4}
body_0.75s: {frame:4}
body_0.8s: {frame:3}
body_0.9s: {frame:4}
body_0.95s: {frame:4}
body_1s: {frame:3}
body_1.1s: {frame:4}
body_1.2s: {frame:4}
effect_0s: {name:CUSTOM|light,x:0,y:0}
effect_0.1s: {name:CUSTOM|bzzz,x:0,y:0}
effect_0.32s: {name:CUSTOM|light,x:0,y:0}
effect_0.64s: {name:CUSTOM|light,x:0,y:0}

[animation_attack]
onActions:attack
body_0s: {frame:3}
body_0.1s: {frame:4}
body_0.15s: {frame:4}
body_0.2s: {frame:3}
body_0.3s: {frame:4}
body_0.35s: {frame:4}
body_0.4s: {frame:3}
body_0.5s: {frame:4}
body_0.55s: {frame:4}
body_0.6s: {frame:3}
body_0.7s: {frame:4}
body_0.75s: {frame:4}
effect_0s: {name:CUSTOM|light,x:0,y:0}
effect_0.1s: {name:CUSTOM|bzzz,x:0,y:0}
effect_0.32s: {name:CUSTOM|light,x:0,y:0}

[animation_harvest_2]
onActions:repair
@copyFromSection:animation_harvest

[animation_harvest_3]
onActions:IGNORE
@copyFromSection:animation_harvest

[resource_psi-emitter]
displayName_ru:Пси-эмулятор
displayName:Psi-emitter
hidden:true

[hiddenAction_feedback_debuff]
@copyFrom_skipThisSection: true

[effect_feedback]
@copyFrom_skipThisSection: true

[hiddenAction_debuff_maelstrom]
@copyFrom_skipThisSection: true

[hiddenAction_debuff_maelstrom_effect]
@copyFrom_skipThisSection: true

[hiddenAction_removeDebuff_maelstrom]
@copyFrom_skipThisSection: true

[decal_grn_circle]
@copyFromSection: template_customSelectCircle
onlyWhenSelectedByOwnPlayer:true
image:ROOT:/DATA/total/circle_smll_grn.png

[decal_red_circle]
@copyFromSection: template_customSelectCircle
onlyWhenSelectedByEnemyPlayer:true
image:ROOT:/DATA/total/circle_smll_red.png

[decal_yellow_circle]
@copyFromSection: template_customSelectCircle
onlyWhenSelectedByAllyNotOwnPlayer:true
image:ROOT:/DATA/total/circle_smll_yell.png

[decal_hp]
@copyFromSection: template_customBar
@define totalFrames:5
image:ROOT:/DATA/total/hp_6.png
frame_width:19
frame_height:5
frame:int((self.hp*100/self.maxHp)/(100/${totalFrames}))
yOffsetAbsolute:14